<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>page3</title>


<style type="text/css">
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  /* padding-top: 10px;
  padding-bottom: 10px; */
  background-color: white;
  /* padding: 30px; */ }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

/* img {
  max-width: 100%; } */

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}

kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb
}

* {
	-webkit-print-color-adjust: exact;
}
/* @media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
} */
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
  body {
    padding: 2cm; 
  }
}
</style>

<style type="text/css">
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #a67f59;
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
</style>


</head>

<body>

<script>
    function copyEvent(id)
    {
        var str = document.getElementById(id);
        window.getSelection().selectAllChildren(str);
        document.execCommand("Copy")
    }
</script>

<style> 
blockquote.red { border-color:#f00; background-color:#f001; } 
blockquote.green { border-color:#0f0; background-color:#0f01; }
blockquote.blue { border-color:#00f; background-color:#00f1; }
</style>

<!-- Use this link instead: https://tanzucommunityedition.io/docs/v0.12/getting-started/ -->

<p>In this chapter, we will deploy a Tanzu managed cluster with two components: a management cluster and a workload cluster. We will start Tanzu TCE and use the web UI to configure and create the management cluster, and then use command line to create the workload cluster. For this managed cluster, we will use AWS as the infrastructure provider. </p>

<h2 id="toc_1">3.1 Start Tanzu TCE</h2>

<blockquote style = "background-color: #fee0d2 ; margin: 0 ; font-family: calibri;border: 2px solid  #67000d; border-left: 6px solid #67000d; padding : 0.5em; border-radius: 8px; background-style:discrete" >
<font size = 3 color =  red> <b> Warning: </b></font>
<font color = 'black'> Before running tanzu commands, you will need to allow your ubuntu user to access Docker Daemon. If you have logged out of the VM instance in chapter 2 after installing Docker, then you are good. Otherwise, do it now: log out and log back into the VM instance with your SSH private key. If this step is not done, you will see error messages when running tanzu commands. 
</blockquote>

<ul>
<li>From your terminal running the AWS EC2 instance, run the following command to start TCE: </li>
</ul>

<pre><button ng-click="copyToClipboard('4-1')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ tanzu management-cluster create --ui --browser none</code><code id = "4-1" hidden>tanzu management-cluster create --ui --browser none</code></pre>

<p>The --browser=none argument tells the command to serve up the web interface, but do not attempt to launch a browser instance to connect to it.</p>

<p>You will see the following output: 
<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-aws/cluster-00.png" width="600px"></p></p>

<p>The above command will start up the Tanzu TCE, and bring up a web page for you to configure and create a cluster. However, on the EC2 Linux instance, we only have command line access without a browser. In this case, we will use a technique called &quot;SSH port forwarding&quot; to forward the web page link to your local computer, so you can connect to the web page created by Tanzu TCE, and configure your cluster on the AWS EC2 VM instance. </p>

<ul>
<li>On your local computer which you use to SSH to the AWS EC2 instance, from the directory containing your .pem key file, run the following command (<span style="color:red"> Replace the &quot;your-key.pem&quot; with the path and name of your own key file, and the &quot;VM_IP&quot; with the public IP of your AWS EC2 instance</span>): </li>
</ul>

<pre><button ng-click="copyToClipboard('4-2')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ ssh -i your-key.pem -N -f -L localhost:8080:localhost:8080 ubuntu@VM_IP</code><code id = "4-2" hidden>ssh -i your-key.pem -N -f -L localhost:8080:localhost:8080 ubuntu@VM_IP</code></pre>

<p>In the above command, you connect to your AWS EC2 instance using the -L argument for local port forwarding. The -N specifies not remote command is executed, and just forward the port. The -f option requests ssh to go to background just before command execution. With the command, the local port 8080 on the remote VM instance is forwarded to your local port 8080 on your local machine. </p>

<blockquote style = "background-color: #e5f5e0 ; margin: 0 ; font-family: calibri;border: 2px solid #00441b; border-left: 6px solid #00441b; padding : 0.5em; border-radius: 8px; background-style:discrete">
<font size = 3 color = green> <b> Note: </b></font>
<font color = "black"> If you are running into an error saying that the port 8080 has been occupied by other application on your local computer, you can simply change the first port to a different numer, e.g., 8081.  In this case your command will be: "ssh -i your-key.pem -N -f -L localhost:8081:localhost:8080 ubuntu@VM_IP" 
</blockquote>

<ul>
<li>Open your web browser from your computer, and open the URL &quot;http://localhost:8080&quot; (or with your own port number if you did not use 8080). If the SSH forwarding works, you will see the following page: </li>
</ul>

<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-aws/cluster-01.png" width="600px"></p>

<h2 id="toc_2">3.2  Create a management cluster on AWS</h2>

<p>In this lab, we will create a managed cluster on AWS infrastructure. From the main Tanzu page, click the &quot;Deploy&quot; in the &quot;Amazon Web Services&quot; section. Click &quot;DEPLOY&quot;. It will ask you to restore cached data if you have done similar step before, just click &quot;START FRESH&quot;.</p>

<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-aws/cluster-02.png" width="400px"></p>

<p>In the configuration steps, Tanzu will ask you to input a number of parameters. </p>

<ul>
<li><p>Validate AWS credentials. From the drop downs, select your AWS credential profile and AWS region:</p>

<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-aws/cluster-03.png" width="600px"></p>

<p>Click &quot;CONNECT&quot; and your credential will be tested. If correct, it will say: &quot;CONNECTED&quot;.</p></li>
<li><p>Click &quot;NEXT&quot;, then configure Kubernetes network settings. You can ask Tanzu to create a new VPC for you on AWS that will be correctly configured, otherwise if you know how to create your own VPC. </p>

<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-aws/cluster-04.png" width="600px"></p></li>
<li><p>Click &quot;NEXT&quot;, then choose management cluster settings. You will need to select AWS EC2 instance type to use as your cluster control node, e.g., t2.large type. And the key pair needs to be an existing keypair that you previously created. For security purpose, you can add a Bastion Host instance in your cluster to access the cluster nodes. Otherwise you can opt out if security is not a big concern (just for dev purpose). For worker node, you will need to choose based on your workload. In this lab we will use t2.large as well. </p>

<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-aws/cluster-06-no-bastion.png" width="600px"></p></li>
<li><p>Click &quot;NEXT&quot;, then input any metadata for your cluster. We will skip them for this lab.
<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-aws/cluster-07.png" width="600px"></p></p></li>
<li><p>Click &quot;NEXT&quot;, then choose Kubernetes network settings. We will use default values and turn off proxy. 
<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-aws/cluster-08.png" width="600px"></p></p></li>
<li><p>Click &quot;NEXT&quot;, then go to &quot;identity Management&quot;. For this lab we will disable Identity Management. </p>

<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-aws/cluster-09.png" width="600px"></p></li>
<li><p>Click &quot;OK&quot;, and finally you will need to choose the OS image type. We will use &quot;Ubuntu-20.04-amd64&quot; image in this lab. </p>

<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-aws/cluster-010.png" width="600px"></p></li>
<li><p>Once you have finished all settings, click &quot;REVIEW CONFIGURATION&quot;. </p>

<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-aws/cluster-011.png" width="600px"></p></li>
<li><p>Then you will shown all the configuration, with the equivalent cli command as following. Click &quot;DEPLOY MANAGEMENT CLUSTER&quot;. </p>

<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-aws/cluster-012.png" width="600px"></p></li>
<li><p>Deployment of the management cluster can take 15-20 minutes to complete. Once it is done, you will see the Tanzu web page like below: </p>

<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-aws/cluster-1.png" width="600px"></p></li>
</ul>

<p>At this point, you can close your browser, as you will complete the rest of the lab on your CLI terminal.</p>

<h2 id="toc_3">3.3 Verify cluster and change settings</h2>

<p>After your management cluster has been created, you can check the cluster status and information, as well as updating settings for kubectl tool. </p>

<h3 id="toc_4">3.3.1 Validate the management cluster started:</h3>

<p>You can check the status and information regarding to your management cluster by using the following command: </p>

<pre><button ng-click="copyToClipboard('4-3')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ tanzu management-cluster get</code><code id = "4-3" hidden>tanzu management-cluster get</code></pre>

<p>You should see an output similar to the following: 
<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-aws/cluster-2.png" width="800px"></p></p>

<h3 id="toc_5">3.3.2 Capture the management cluster’s kubeconfig</h3>

<p>You should now check the configuration for your cluster, and take note of the command for accessing the cluster in the message, as you will use this for setting the context in the next step. Run the following command to save your cluster credentials into </p>

<pre><button ng-click="copyToClipboard('4-4')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ tanzu management-cluster kubeconfig get &lt;MGMT-CLUSTER-NAME&gt; --admin</code><code id = "4-4" hidden>tanzu management-cluster kubeconfig get &lt;MGMT-CLUSTER-NAME&gt; --admin</code></pre>

<p>You should see an output similar to the following: 
<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-docker/cluster-13.png" width="800px"></p></p>

<h3 id="toc_6">3.3.3 Set your kubectl context to the management cluster.</h3>

<pre><button ng-click="copyToClipboard('4-5')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ kubectl config use-context &lt;MGMT-CLUSTER-NAME&gt;-admin@&lt;MGMT-CLUSTER-NAME&gt;</code><code id = "4-5" hidden>kubectl config use-context &lt;MGMT-CLUSTER-NAME&gt;-admin@&lt;MGMT-CLUSTER-NAME&gt;</code></pre>

<p>You should see an output similar to the following: 
<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-docker/cluster-14.png" width="700px"></p></p>

<h3 id="toc_7">3.3.4 Validate you can access the management cluster’s API server.</h3>

<pre><button ng-click="copyToClipboard('4-6')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ kubectl get nodes</code><code id = "4-6" hidden>kubectl get nodes</code></pre>

<p>You should see an output similar to the following: 
<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-docker/cluster-15.png" width="700px"></p></p>

<h2 id="toc_8">3.4 Deploy a Workload Cluster</h2>

<p>Now you will create a workload cluster, which is basically worker nodes to perform tasks specified from the management cluster. </p>

<h3 id="toc_9">3.4.1 Create workload cluster configuration</h3>

<p>Copy the management cluster configuration file and modify it to use workload cluster, using the command below: </p>

<pre><button ng-click="copyToClipboard('4-7')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ ls ~/.config/tanzu/tkg/clusterconfigs/
# You will see one .yaml file in there
$ cp ~/.config/tanzu/tkg/clusterconfigs/&quot;Name_of_the_file&quot;.yaml ~/.config/tanzu/tkg/clusterconfigs/worker.yaml
$ sed -i &quot;s/CLUSTER_NAME: my-cluster/CLUSTER_NAME: worker-cluster/g&quot; ~/.config/tanzu/tkg/clusterconfigs/worker.yaml</code><code id = "4-7" hidden>ls ~/.config/tanzu/tkg/clusterconfigs/
cp ~/.config/tanzu/tkg/clusterconfigs/&quot;Name_of_the_file&quot;.yaml ~/.config/tanzu/tkg/clusterconfigs/worker.yaml
sed -i &quot;s/CLUSTER_NAME: my-cluster/CLUSTER_NAME: worker-cluster/g&quot; ~/.config/tanzu/tkg/clusterconfigs/worker.yaml</code></pre>

<p>Verify that the cluster name has been correctly replaced: 
<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-aws/cluster-4.png" width="600px"></p></p>

<h3 id="toc_10">3.4.2 Create the workload cluster</h3>

<pre><button ng-click="copyToClipboard('4-8')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ tanzu cluster create worker-cluster --file ~/.config/tanzu/tkg/clusterconfigs/worker.yaml</code><code id = "4-8" hidden>tanzu cluster create worker-cluster --file ~/.config/tanzu/tkg/clusterconfigs/worker.yaml</code></pre>

<p>You should see an output similar to the following: 
<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-aws/cluster-5.png" width="800px"></p></p>

<h3 id="toc_11">3.4.3 Validate the cluster starts successfully.</h3>

<pre><button ng-click="copyToClipboard('4-9')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ tanzu cluster list</code><code id = "4-9" hidden>tanzu cluster list</code></pre>

<p>You should see an output similar to the following: 
<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-docker/cluster-17.png" width="700px"></p></p>

<h3 id="toc_12">3.4.4 Capture the workload cluster’s kubeconfig.</h3>

<pre><button ng-click="copyToClipboard('4-10')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ tanzu cluster kubeconfig get &lt;WORKLOAD-CLUSTER-NAME&gt; --admin</code><code id = "4-10" hidden>tanzu cluster kubeconfig get &lt;WORKLOAD-CLUSTER-NAME&gt; --admin</code></pre>

<p>You should see an output similar to the following: 
<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-docker/cluster-18.png" width="800px"></p></p>

<h3 id="toc_13">3.4.5 Set your kubectl context accordingly.</h3>

<pre><button ng-click="copyToClipboard('4-11')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ kubectl config use-context &lt;WORKLOAD-CLUSTER-NAME&gt;-admin@&lt;WORKLOAD-CLUSTER-NAME&gt;</code><code id = "4-11" hidden>kubectl config use-context &lt;WORKLOAD-CLUSTER-NAME&gt;-admin@&lt;WORKLOAD-CLUSTER-NAME&gt;</code></pre>

<p>You should see an output similar to the following: 
<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-docker/cluster-19.png" width="800px"></p></p>

<h3 id="toc_14">3.4.6 Verify you can see pods in the cluster.</h3>

<pre><button ng-click="copyToClipboard('4-12')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ kubectl get pods --all-namespaces</code><code id = "4-12" hidden>kubectl get pods --all-namespaces</code></pre>

<p>You should see an output similar to the following: 
<p align="center"> <img src="/MizzouCloudDevOps/img/lab5/managedCluster-docker/cluster-20.png" width="800px"></p></p>



<script type="text/javascript">
var _self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{},Prism=function(){var e=/\blang(?:uage)?-(\w+)\b/i,t=0,n=_self.Prism={util:{encode:function(e){return e instanceof a?new a(e.type,n.util.encode(e.content),e.alias):"Array"===n.util.type(e)?e.map(n.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++t}),e.__id},clone:function(e){var t=n.util.type(e);switch(t){case"Object":var a={};for(var r in e)e.hasOwnProperty(r)&&(a[r]=n.util.clone(e[r]));return a;case"Array":return e.map&&e.map(function(e){return n.util.clone(e)})}return e}},languages:{extend:function(e,t){var a=n.util.clone(n.languages[e]);for(var r in t)a[r]=t[r];return a},insertBefore:function(e,t,a,r){r=r||n.languages;var l=r[e];if(2==arguments.length){a=arguments[1];for(var i in a)a.hasOwnProperty(i)&&(l[i]=a[i]);return l}var o={};for(var s in l)if(l.hasOwnProperty(s)){if(s==t)for(var i in a)a.hasOwnProperty(i)&&(o[i]=a[i]);o[s]=l[s]}return n.languages.DFS(n.languages,function(t,n){n===r[e]&&t!=e&&(this[t]=o)}),r[e]=o},DFS:function(e,t,a,r){r=r||{};for(var l in e)e.hasOwnProperty(l)&&(t.call(e,l,e[l],a||l),"Object"!==n.util.type(e[l])||r[n.util.objId(e[l])]?"Array"!==n.util.type(e[l])||r[n.util.objId(e[l])]||(r[n.util.objId(e[l])]=!0,n.languages.DFS(e[l],t,l,r)):(r[n.util.objId(e[l])]=!0,n.languages.DFS(e[l],t,null,r)))}},plugins:{},highlightAll:function(e,t){var a={callback:t,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};n.hooks.run("before-highlightall",a);for(var r,l=a.elements||document.querySelectorAll(a.selector),i=0;r=l[i++];)n.highlightElement(r,e===!0,a.callback)},highlightElement:function(t,a,r){for(var l,i,o=t;o&&!e.test(o.className);)o=o.parentNode;o&&(l=(o.className.match(e)||[,""])[1],i=n.languages[l]),t.className=t.className.replace(e,"").replace(/\s+/g," ")+" language-"+l,o=t.parentNode,/pre/i.test(o.nodeName)&&(o.className=o.className.replace(e,"").replace(/\s+/g," ")+" language-"+l);var s=t.textContent,u={element:t,language:l,grammar:i,code:s};if(!s||!i)return n.hooks.run("complete",u),void 0;if(n.hooks.run("before-highlight",u),a&&_self.Worker){var c=new Worker(n.filename);c.onmessage=function(e){u.highlightedCode=e.data,n.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(u.element),n.hooks.run("after-highlight",u),n.hooks.run("complete",u)},c.postMessage(JSON.stringify({language:u.language,code:u.code,immediateClose:!0}))}else u.highlightedCode=n.highlight(u.code,u.grammar,u.language),n.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(t),n.hooks.run("after-highlight",u),n.hooks.run("complete",u)},highlight:function(e,t,r){var l=n.tokenize(e,t);return a.stringify(n.util.encode(l),r)},tokenize:function(e,t){var a=n.Token,r=[e],l=t.rest;if(l){for(var i in l)t[i]=l[i];delete t.rest}e:for(var i in t)if(t.hasOwnProperty(i)&&t[i]){var o=t[i];o="Array"===n.util.type(o)?o:[o];for(var s=0;s<o.length;++s){var u=o[s],c=u.inside,g=!!u.lookbehind,h=!!u.greedy,f=0,d=u.alias;u=u.pattern||u;for(var p=0;p<r.length;p++){var m=r[p];if(r.length>e.length)break e;if(!(m instanceof a)){u.lastIndex=0;var y=u.exec(m),v=1;if(!y&&h&&p!=r.length-1){var b=r[p+1].matchedStr||r[p+1],k=m+b;if(p<r.length-2&&(k+=r[p+2].matchedStr||r[p+2]),u.lastIndex=0,y=u.exec(k),!y)continue;var w=y.index+(g?y[1].length:0);if(w>=m.length)continue;var _=y.index+y[0].length,P=m.length+b.length;if(v=3,P>=_){if(r[p+1].greedy)continue;v=2,k=k.slice(0,P)}m=k}if(y){g&&(f=y[1].length);var w=y.index+f,y=y[0].slice(f),_=w+y.length,S=m.slice(0,w),O=m.slice(_),j=[p,v];S&&j.push(S);var A=new a(i,c?n.tokenize(y,c):y,d,y,h);j.push(A),O&&j.push(O),Array.prototype.splice.apply(r,j)}}}}}return r},hooks:{all:{},add:function(e,t){var a=n.hooks.all;a[e]=a[e]||[],a[e].push(t)},run:function(e,t){var a=n.hooks.all[e];if(a&&a.length)for(var r,l=0;r=a[l++];)r(t)}}},a=n.Token=function(e,t,n,a,r){this.type=e,this.content=t,this.alias=n,this.matchedStr=a||null,this.greedy=!!r};if(a.stringify=function(e,t,r){if("string"==typeof e)return e;if("Array"===n.util.type(e))return e.map(function(n){return a.stringify(n,t,e)}).join("");var l={type:e.type,content:a.stringify(e.content,t,r),tag:"span",classes:["token",e.type],attributes:{},language:t,parent:r};if("comment"==l.type&&(l.attributes.spellcheck="true"),e.alias){var i="Array"===n.util.type(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(l.classes,i)}n.hooks.run("wrap",l);var o="";for(var s in l.attributes)o+=(o?" ":"")+s+'="'+(l.attributes[s]||"")+'"';return"<"+l.tag+' class="'+l.classes.join(" ")+'" '+o+">"+l.content+"</"+l.tag+">"},!_self.document)return _self.addEventListener?(_self.addEventListener("message",function(e){var t=JSON.parse(e.data),a=t.language,r=t.code,l=t.immediateClose;_self.postMessage(n.highlight(r,n.languages[a],a)),l&&_self.close()},!1),_self.Prism):_self.Prism;var r=document.currentScript||[].slice.call(document.getElementsByTagName("script")).pop();return r&&(n.filename=r.src,document.addEventListener&&!r.hasAttribute("data-manual")&&document.addEventListener("DOMContentLoaded",n.highlightAll)),_self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism),"undefined"!=typeof global&&(global.Prism=Prism);
</script>

<script type="text/javascript">
!function(e){var t={variable:[{pattern:/\$?\(\([\w\W]+?\)\)/,inside:{variable:[{pattern:/(^\$\(\([\w\W]+)\)\)/,lookbehind:!0},/^\$\(\(/],number:/\b-?(?:0x[\dA-Fa-f]+|\d*\.?\d+(?:[Ee]-?\d+)?)\b/,operator:/--?|-=|\+\+?|\+=|!=?|~|\*\*?|\*=|\/=?|%=?|<<=?|>>=?|<=?|>=?|==?|&&?|&=|\^=?|\|\|?|\|=|\?|:/,punctuation:/\(\(?|\)\)?|,|;/}},{pattern:/\$\([^)]+\)|`[^`]+`/,inside:{variable:/^\$\(|^`|\)$|`$/}},/\$(?:[a-z0-9_#\?\*!@]+|\{[^}]+\})/i]};e.languages.bash={shebang:{pattern:/^#!\s*\/bin\/bash|^#!\s*\/bin\/sh/,alias:"important"},comment:{pattern:/(^|[^"{\\])#.*/,lookbehind:!0},string:[{pattern:/((?:^|[^<])<<\s*)(?:"|')?(\w+?)(?:"|')?\s*\r?\n(?:[\s\S])*?\r?\n\2/g,lookbehind:!0,inside:t},{pattern:/(["'])(?:\\\\|\\?[^\\])*?\1/g,inside:t}],variable:t.variable,"function":{pattern:/(^|\s|;|\||&)(?:alias|apropos|apt-get|aptitude|aspell|awk|basename|bash|bc|bg|builtin|bzip2|cal|cat|cd|cfdisk|chgrp|chmod|chown|chroot|chkconfig|cksum|clear|cmp|comm|command|cp|cron|crontab|csplit|cut|date|dc|dd|ddrescue|df|diff|diff3|dig|dir|dircolors|dirname|dirs|dmesg|du|egrep|eject|enable|env|ethtool|eval|exec|expand|expect|export|expr|fdformat|fdisk|fg|fgrep|file|find|fmt|fold|format|free|fsck|ftp|fuser|gawk|getopts|git|grep|groupadd|groupdel|groupmod|groups|gzip|hash|head|help|hg|history|hostname|htop|iconv|id|ifconfig|ifdown|ifup|import|install|jobs|join|kill|killall|less|link|ln|locate|logname|logout|look|lpc|lpr|lprint|lprintd|lprintq|lprm|ls|lsof|make|man|mkdir|mkfifo|mkisofs|mknod|more|most|mount|mtools|mtr|mv|mmv|nano|netstat|nice|nl|nohup|notify-send|nslookup|open|op|passwd|paste|pathchk|ping|pkill|popd|pr|printcap|printenv|printf|ps|pushd|pv|pwd|quota|quotacheck|quotactl|ram|rar|rcp|read|readarray|readonly|reboot|rename|renice|remsync|rev|rm|rmdir|rsync|screen|scp|sdiff|sed|seq|service|sftp|shift|shopt|shutdown|sleep|slocate|sort|source|split|ssh|stat|strace|su|sudo|sum|suspend|sync|tail|tar|tee|test|time|timeout|times|touch|top|traceroute|trap|tr|tsort|tty|type|ulimit|umask|umount|unalias|uname|unexpand|uniq|units|unrar|unshar|uptime|useradd|userdel|usermod|users|uuencode|uudecode|v|vdir|vi|vmstat|wait|watch|wc|wget|whereis|which|who|whoami|write|xargs|xdg-open|yes|zip)(?=$|\s|;|\||&)/,lookbehind:!0},keyword:{pattern:/(^|\s|;|\||&)(?:let|:|\.|if|then|else|elif|fi|for|break|continue|while|in|case|function|select|do|done|until|echo|exit|return|set|declare)(?=$|\s|;|\||&)/,lookbehind:!0},"boolean":{pattern:/(^|\s|;|\||&)(?:true|false)(?=$|\s|;|\||&)/,lookbehind:!0},operator:/&&?|\|\|?|==?|!=?|<<<?|>>|<=?|>=?|=~/,punctuation:/\$?\(\(?|\)\)?|\.\.|[{}[\];]/};var a=t.variable[1].inside;a["function"]=e.languages.bash["function"],a.keyword=e.languages.bash.keyword,a.boolean=e.languages.bash.boolean,a.operator=e.languages.bash.operator,a.punctuation=e.languages.bash.punctuation}(Prism);
</script>


</body>

</html>
