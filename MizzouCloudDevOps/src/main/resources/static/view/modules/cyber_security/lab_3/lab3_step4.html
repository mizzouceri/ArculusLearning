<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Chapter3</title>


<style type="text/css">
body {
font-family: Helvetica, arial, sans-serif;
font-size: 14px;
line-height: 1.6;
/* padding-top: 10px;
padding-bottom: 10px; */
background-color: white;
/* padding: 30px; */
}

/* Style buttons */
.copyButton {
right: 70px;
position: absolute;
/*positioned relative to its parent element*/
background-color: none;
border: none;
/* Remove borders */
color: black;
/*  text */
font-size: 22px;
/* Set a font size */
padding: 0;
cursor: pointer;
/* Mouse pointer on hover */
background-position-x: 8px;
background-position-y: 6px;
}

.yamlTag {
right: 70px;
position: absolute;
/*positioned relative to its parent element*/
background-color: none;
color: grey;
/*  text */
font-size: 18px;
/* Set a font size */
padding: 0;
margin-top: -4px;
cursor: auto;
/* Mouse pointer on hover */
background-position-x: 8px;
background-position-y: 6px;
}

/* Darker background on mouse-over */
.copyButton:hover {
background-color: #CACFD2;
}

body>*:first-child {
margin-top: 0 !important;
}

body>*:last-child {
margin-bottom: 0 !important;
}

a {
color: #4183C4;
}

a.absent {
color: #cc0000;
}

a.anchor {
display: block;
padding-left: 30px;
margin-left: -30px;
cursor: pointer;
position: absolute;
top: 0;
left: 0;
bottom: 0;
}

h1,
h2,
h3,
h4,
h5,
h6 {
margin: 20px 0 10px;
padding: 0;
font-weight: bold;
-webkit-font-smoothing: antialiased;
cursor: text;
position: relative;
}

h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
text-decoration: none;
}

h1 tt,
h1 code {
font-size: inherit;
}

h2 tt,
h2 code {
font-size: inherit;
}

h3 tt,
h3 code {
font-size: inherit;
}

h4 tt,
h4 code {
font-size: inherit;
}

h5 tt,
h5 code {
font-size: inherit;
}

h6 tt,
h6 code {
font-size: inherit;
}

h1 {
font-size: 28px;
color: black;
}

h2 {
font-size: 24px;
border-bottom: 1px solid #cccccc;
color: black;
}

h3 {
font-size: 18px;
}

h4 {
font-size: 16px;
}

h5 {
font-size: 14px;
}

h6 {
color: #777777;
font-size: 14px;
}

p,
blockquote,
ul,
ol,
dl,
li,
table,
pre {
margin: 15px 0;
}

hr {
background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
border: 0 none;
color: #cccccc;
height: 4px;
padding: 0;
}

body>h2:first-child {
margin-top: 0;
padding-top: 0;
}

body>h1:first-child {
margin-top: 0;
padding-top: 0;
}

body>h1:first-child+h2 {
margin-top: 0;
padding-top: 0;
}

body>h3:first-child,
body>h4:first-child,
body>h5:first-child,
body>h6:first-child {
margin-top: 0;
padding-top: 0;
}

a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
margin-top: 0;
padding-top: 0;
}

h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
margin-top: 0;
}

li p.first {
display: inline-block;
}

li {
margin: 0;
}

ul,
ol {
padding-left: 30px;
}

ul :first-child,
ol :first-child {
margin-top: 0;
}

dl {
padding: 0;
}

dl dt {
font-size: 14px;
font-weight: bold;
font-style: italic;
padding: 0;
margin: 15px 0 5px;
}

dl dt:first-child {
padding: 0;
}

dl dt> :first-child {
margin-top: 0;
}

dl dt> :last-child {
margin-bottom: 0;
}

dl dd {
margin: 0 0 15px;
padding: 0 15px;
}

dl dd> :first-child {
margin-top: 0;
}

dl dd> :last-child {
margin-bottom: 0;
}

blockquote {
border-left: 4px solid #dddddd;
padding: 0 15px;
color: #777777;
}

blockquote> :first-child {
margin-top: 0;
}

blockquote> :last-child {
margin-bottom: 0;
}

table {
padding: 0;
border-collapse: collapse;
}

table tr {
border-top: 1px solid #cccccc;
background-color: white;
margin: 0;
padding: 0;
}

table tr:nth-child(2n) {
background-color: #f8f8f8;
}

table tr th {
font-weight: bold;
border: 1px solid #cccccc;
margin: 0;
padding: 6px 13px;
}

table tr td {
border: 1px solid #cccccc;
margin: 0;
padding: 6px 13px;
}

table tr th :first-child,
table tr td :first-child {
margin-top: 0;
}

table tr th :last-child,
table tr td :last-child {
margin-bottom: 0;
}

/* img {
max-width: 100%; } */

span.frame {
display: block;
overflow: hidden;
}

span.frame>span {
border: 1px solid #dddddd;
display: block;
float: left;
overflow: hidden;
margin: 13px 0 0;
padding: 7px;
width: auto;
}

span.frame span img {
display: block;
float: left;
}

span.frame span span {
clear: both;
color: #333333;
display: block;
padding: 5px 0 0;
}

span.align-center {
display: block;
overflow: hidden;
clear: both;
}

span.align-center>span {
display: block;
overflow: hidden;
margin: 13px auto 0;
text-align: center;
}

span.align-center span img {
margin: 0 auto;
text-align: center;
}

span.align-right {
display: block;
overflow: hidden;
clear: both;
}

span.align-right>span {
display: block;
overflow: hidden;
margin: 13px 0 0;
text-align: right;
}

span.align-right span img {
margin: 0;
text-align: right;
}

span.float-left {
display: block;
margin-right: 13px;
overflow: hidden;
float: left;
}

span.float-left span {
margin: 13px 0 0;
}

span.float-right {
display: block;
margin-left: 13px;
overflow: hidden;
float: right;
}

span.float-right>span {
display: block;
overflow: hidden;
margin: 13px auto 0;
text-align: right;
}

code,
tt {
margin: 0 2px;
padding: 0 5px;
white-space: nowrap;
border: 1px solid #eaeaea;
background-color: #f8f8f8;
border-radius: 3px;
}

pre code {
margin: 0;
padding: 0;
white-space: pre;
border: none;
background: transparent;
}

.highlight pre {
background-color: #f8f8f8;
border: 1px solid #cccccc;
font-size: 13px;
line-height: 19px;
overflow: auto;
padding: 6px 10px;
border-radius: 3px;
}

pre {
background-color: #f8f8f8;
border: 1px solid #cccccc;
font-size: 13px;
line-height: 19px;
overflow: auto;
padding: 6px 10px;
border-radius: 3px;
}

pre code,
pre tt {
background-color: transparent;
border: none;
}

sup {
font-size: 0.83em;
vertical-align: super;
line-height: 0;
}

kbd {
display: inline-block;
padding: 3px 5px;
font-size: 11px;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb
}

* {
-webkit-print-color-adjust: exact;
}

/* @media screen and (min-width: 914px) {
body {
width: 854px;
margin:0 auto;
}
} */
@media print {

table,
pre {
page-break-inside: avoid;
}

pre {
word-wrap: break-word;
}

body {
padding: 2cm;
}
}
</style>

<style type="text/css">
/**
* prism.js default theme for JavaScript, CSS and HTML
* Based on dabblet (http://dabblet.com)
* @author Lea Verou
*/

code[class*="language-"],
pre[class*="language-"] {
color: black;
background: none;
text-shadow: 0 1px white;
font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
text-align: left;
white-space: pre;
word-spacing: normal;
word-break: normal;
word-wrap: normal;
line-height: 1.5;

-moz-tab-size: 4;
-o-tab-size: 4;
tab-size: 4;

-webkit-hyphens: none;
-moz-hyphens: none;
-ms-hyphens: none;
hyphens: none;
}

pre[class*="language-"]::-moz-selection,
pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection,
code[class*="language-"] ::-moz-selection {
text-shadow: none;
background: #b3d4fc;
}

pre[class*="language-"]::selection,
pre[class*="language-"] ::selection,
code[class*="language-"]::selection,
code[class*="language-"] ::selection {
text-shadow: none;
background: #b3d4fc;
}

@media print {

code[class*="language-"],
pre[class*="language-"] {
text-shadow: none;
}
}

/* Code blocks */
pre[class*="language-"] {
padding: 1em;
margin: .5em 0;
overflow: auto;
}

:not(pre)>code[class*="language-"],
pre[class*="language-"] {
background: #f5f2f0;
}

/* Inline code */
:not(pre)>code[class*="language-"] {
padding: .1em;
border-radius: .3em;
white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
color: slategray;
}

.token.punctuation {
color: #999;
}

.namespace {
opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
color: #a67f59;
background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
color: #07a;
}

.token.function {
color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
color: #e90;
}

.token.important,
.token.bold {
font-weight: bold;
}

.token.italic {
font-style: italic;
}

.token.entity {
cursor: help;
}
</style>

<style type="text/css">
div.prism-show-language {
position: relative;
}

div.prism-show-language>div.prism-show-language-label {
color: black;
background-color: #CFCFCF;
display: inline-block;
position: absolute;
bottom: auto;
left: auto;
top: 0;
right: 0;
width: auto;
height: auto;
font-size: 0.9em;
border-radius: 0 0 0 5px;
padding: 0 0.5em;
text-shadow: none;
z-index: 1;
-webkit-box-shadow: none;
-moz-box-shadow: none;
box-shadow: none;
-webkit-transform: none;
-moz-transform: none;
-ms-transform: none;
-o-transform: none;
transform: none;
}
</style>


</head>

<body>

<p><a name="Ch2"></a></p>

<h1 id="toc_0"><strong>Chapter 3</strong> - K3S Cluster Installation and Configuration</h1>

<p>In this chapter, you will install and configure K3S on all the nodes, including the Cloud node, and the two
Edge nodes.</p>

<blockquote
style="background-color: #e5f5e0 ; margin: 0 ; font-family: calibri;border: 2px solid #00441b; border-left: 6px solid #00441b; padding : 0.5em; border-radius: 8px; background-style:discrete">
<font size=3 color=green> <b> Note: </b></font>
<font color='black'>If something is wrong during your installation process and you can not have your cluster running
appropriately,
we recommend that you delete the troubling EC2 instance and start from the beginning of the installation process.
We have tried to re-install/re-configure either the Cloud node and the Edge nodes, and had encountered
many other issues. We do not recommend spending a lot of time/efforts debugging, but rather, we recommend
creating and installing a fresh node.</font>
</blockquote>

<h2 id="toc_1">3.1 K3S installation on Cloud node</h2>

<p>This section guides you to perform pre-installation setup on the Cloud node.
SSH login to your Cloud node
using the EC2 InstanceConnect service using the "Connect" button, login to all of your EC2 instances by following the example here:
</p>
<p>
    <center><img src="/MizzouCloudDevOps/img/lab3/ec2-connect.png" width=700></center>
</p>
<p>
<center><img src="/MizzouCloudDevOps/img/lab3/ec2-login.png" width=700></center>
</p>

<ul>
<li>
<p>Switch to root user
All the installation requires to have root privilege. Switch to root user:</p>

<div><pre><button ng-click="copyToClipboard('3-1')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ sudo su</code><code id = "3-1" hidden>sudo su</code></pre></div>
</li>
<li>
<p>Execute the below command to set the required environment variables and install K3S on the Cloud node.
This will also install all other required libraries and tools, and at the end it will create a K3S cluster. Run
the following commands, and replace “Cloud-Node-Public-IP” with your Cloud node public IP address.</p>

<!-- <div><pre><code class="language-bash">$ cd /root
$ git clone https://github.com/wangso/K3S-demo.git</code></pre></div></li>
<li><p>Allow Root SSH login with password</p>

<div><pre><code class="language-bash">$ sed -i &quot;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/g&quot; /etc/ssh/sshd_config
$ sed -i &quot;s/PasswordAuthentication no/PasswordAuthentication yes/g&quot; /etc/ssh/sshd_config
$ systemctl restart sshd</code></pre></div></li>
<li><p>Create root user password</p>

<div><pre><code class="language-bash">$ passwd</code></pre></div> -->

<!-- <p>Create your root password by following screen prompts. Keep record of the password you have input.</p></li>
<li><p>Install K3S on Cloud node and create a K3S cluster Use our automated scripts to install K3S on the Cloud node, which also will install all other required libraries and tools, and at the end it will create K3S cluster. Run the following commands, and replace “Cloud-Core-Public-IP” with your Cloud node public IP address.</p> -->

<div><pre><button ng-click="copyToClipboard('3-2')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ export K3S_NODE_NAME=cloud && export INSTALL_K3S_EXEC="--write-kubeconfig ~/.kube/config --write-kubeconfig-mode 666 --node-external-ip {Cloud-Node-Public-IP} --tls-san {Cloud-Node-Public-IP}" && curl -sfL https://get.k3s.io | sh -s - </code><code id = "3-2" hidden>export K3S_NODE_NAME=cloud && export INSTALL_K3S_EXEC="--write-kubeconfig ~/.kube/config --write-kubeconfig-mode 666 --node-external-ip {Cloud-Node-Public-IP} --tls-san {Cloud-Node-Public-IP}" && curl -sfL https://get.k3s.io | sh -s - </code></pre></div>
<p>For example:</p>

<div><pre><button ng-click="copyToClipboard('3-3')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ export K3S_NODE_NAME=cloud && export INSTALL_K3S_EXEC="--write-kubeconfig ~/.kube/config --write-kubeconfig-mode 666 --node-external-ip 54.243.15.167 --tls-san 54.243.15.167" && curl -sfL https://get.k3s.io | sh -s - </code><code id = "3-3" hidden>export K3S_NODE_NAME=cloud && export INSTALL_K3S_EXEC="--write-kubeconfig ~/.kube/config --write-kubeconfig-mode 666 --node-external-ip 54.243.15.167 --tls-san 54.243.15.167" && curl -sfL https://get.k3s.io | sh -s - </code></pre></div>

<p>When prompted with a pop-up window asking you to configure openssh server, just hit enter.
When prompted to create an ssh key pair, just hit enter to create to the default file as “id_rsa”, and leave
with no password (this is set so to allow Cloud node to login to the Edge nodes without having to ask
you to input passphrase of the SSH key in the future).</p>

<p>
<blockquote
style="background-color: #e5f5e0 ; margin: 0 ; font-family: calibri;border: 2px solid #00441b; border-left: 6px solid #00441b; padding : 0.5em; border-radius: 8px; background-style:discrete">
<font size=3 color=green> <b> Note: </b></font>
<font color="black">
This process could take 1-2 minutes to complete.
</blockquote>
</font>
</p>
</li>
</ul>

<p>Run the following commands on the cloud node to check for your installation:</p>

<div><pre><button ng-click="copyToClipboard('3-7')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ kubectl get nodes</code><code id = "3-7" hidden>kubectl get nodes</code></pre></div>

<p>You will see the following output:</p>

<p>
<center><img src="/MizzouCloudDevOps/img/lab3/cloud-core-node.png" width=600></center>
</p>


<p>For the next step, to add worker (edge) nodes to the master node's cluster we just created, we will have to acquire
the master node's secret K3S token. Run the following command on the master node to </p>

<div><pre><button ng-click="copyToClipboard('3-100')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ sudo cat /var/lib/rancher/k3s/server/node-token | GREP_COLOR='01;32' grep --color=always '.' ; echo -e "\e[0m"</code><code id = "3-100" hidden>sudo cat /var/lib/rancher/k3s/server/node-token | GREP_COLOR='01;32' grep --color=always '.' ; echo -e "\e[0m"</code></pre></div>

<p>Note down the green string from the output. This is the K3S secret token for other nodes to join the cluster as
worker nodes. </p>

<p>
<center><img src="/MizzouCloudDevOps/img/lab3/k3s-token.png" width=700></center>
</p>

<h2 id="toc_2">3.2 K3S Agent Installation and Configuration on both Edge nodes</h2>

<p>On each of your Edge node, do the following (similar to the Cloud node) to allow SSH communication of the
nodes.
SSH login to your Cloud node
using the EC2 InstanceConnect service using the "Connect" button, login to all of your EC2 instances by following the example here:
</p>
<p>
    <center><img src="/MizzouCloudDevOps/img/lab3/ec2-connect.png" width=700></center>
</p>
<p>
<center><img src="/MizzouCloudDevOps/img/lab3/ec2-login.png" width=700></center>
</p>

<ul>
<li>
<p>Switch to root user
All the installation requires to have root privilege. Switch to root user:</p>

<div><pre><button ng-click="copyToClipboard('3-4')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ sudo su</code><code id = "3-4" hidden>sudo su</code></pre></div>
</li>
<li>
<p>Update the OS</p>

<div><pre><button ng-click="copyToClipboard('3-5')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ apt-get update</code><code id = "3-5" hidden>apt-get update</code></pre></div>
</li>
</ul>

<p>To set up the two worker nodes, on each of the Edge
    nodes, run the following command to join the node to the K3S cluster running on the Cloud node VM. In
    the join command, there are three variables that need to be replaced with your own values: “cloud_node_IP”
    with your Cloud node IP, "secret_token" with the long string you copied from the Cloud node, and the
    “node_name” should be "edge1" for the first node, and "edge2" for the second node. This is in order to keep it
    consistent for the Kubernetes manifest files we will be executing later.</p>
    
    <p>
    <blockquote
    style="background-color: #fee0d2 ; margin: 0 ; font-family: calibri;border: 2px solid  #67000d; border-left: 6px solid #67000d; padding : 0.5em; border-radius: 8px; background-style:discrete">
    <font size=3 color=red> <b> Warning: </b></font>
    <font color="black">
    Make sure you use the specified names for all three nodes, otherwise you will have conflicts
    between nodes and wont be able to map pods to the respective nodes in the cluster.
    </blockquote>
    </font>
    </p>
    
    <ul>
    <li>
    <p>Join K3S cluster as worker nodes</p>
    
    <div><pre><button ng-click="copyToClipboard('3-8')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ export K3S_NODE_NAME={node_name} && export K3S_URL="https://{cloud_node_IP}:6443" && export K3S_TOKEN={secret_token} && curl -sfL "https://get.k3s.io" | sh -s -</code><code id = "3-8" hidden>export K3S_NODE_NAME={node_name} && export K3S_URL="https://{cloud_node_IP}:6443" && export K3S_TOKEN={secret_token} && curl -sfL "https://get.k3s.io" | sh -s -</code></pre></div>
    
    <p>For example:</p>
    
    <div><pre><button ng-click="copyToClipboard('3-9')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ export K3S_NODE_NAME=edge1 && export K3S_URL="https://18.118.47.93:6443" && export K3S_TOKEN=K10d4a67522b3ce02ea6f61640c0d4a098bb449faf63d8986e921c9e1a31fac83d8::server:b572fa37aa05f970c6cbe944a37034dc && curl -sfL "https://get.k3s.io" | sh -s -</code><code id = "3-9" hidden>export K3S_NODE_NAME=edge1 && export K3S_URL="https://18.118.47.93:6443" && export K3S_TOKEN=K10d4a67522b3ce02ea6f61640c0d4a098bb449faf63d8986e921c9e1a31fac83d8::server:b572fa37aa05f970c6cbe944a37034dc && curl -sfL "https://get.k3s.io" | sh -s -</code></pre></div>
    </li>
    </ul>
    

<!-- <li><p>Clone our prepared GitHub repository to your node:</p>

<div><pre><code class="language-bash">$ cd /root
$ git clone https://github.com/wangso/K3S-demo.git</code></pre></div></li>
<li><p>Allow Root SSH login with password</p>

<div><pre><code class="language-bash">$ sed -i &quot;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/g&quot; /etc/ssh/sshd_config
$ sed -i &quot;s/PasswordAuthentication no/PasswordAuthentication yes/g&quot; /etc/ssh/sshd_config
$ systemctl restart sshd</code></pre></div></li>
<li><p>Create root user password</p>

<div><pre><code class="language-bash">$ passwd</code></pre></div></li>
</ul>

<p>Create your root password by following screen prompts. Keep record of the password you have input. We recommend you use the same password on all the nodes to avoid mistakes and confusion.</p>
-->
<!-- <p>
<blockquote
style="background-color: #e5f5e0 ; margin: 0 ; font-family: calibri;border: 2px solid #00441b; border-left: 6px solid #00441b; padding : 0.5em; border-radius: 8px; background-style:discrete">
<font size=3 color=green> <b> Note: </b></font>
<font color="black">
This process would not take more than a minute to complete.
</blockquote>
</font>
</p> -->





<h2 id="toc_5">3.3 Check your K3S cluster status</h2>

<p>At this point, you will have a K3S cluster configured and up and running. Run the following command on the
Cloud node to check the status of the cluster.</p>

<div><pre><button ng-click="copyToClipboard('3-10')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ kubectl get nodes</code><code id = "3-10" hidden>kubectl get nodes</code></pre></div>

<p>If everything has been installed and configured correctly, you will see that the cluster has the master node and
the two edge nodes ready as follows:</p>

<p>
<center><img src="/MizzouCloudDevOps/img/lab3/node2.png" width=700></center>
</p>

<p>Congratulations, your have successfully installed and configured a K3S cluster with one master node and two
worker nodes!</p>



<script type="text/javascript">
var _self = "undefined" != typeof window ? window : "undefined" != typeof WorkerGlobalScope && self instanceof WorkerGlobalScope ? self : {}, Prism = function () { var e = /\blang(?:uage)?-(\w+)\b/i, t = 0, n = _self.Prism = { util: { encode: function (e) { return e instanceof a ? new a(e.type, n.util.encode(e.content), e.alias) : "Array" === n.util.type(e) ? e.map(n.util.encode) : e.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/\u00a0/g, " ") }, type: function (e) { return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1] }, objId: function (e) { return e.__id || Object.defineProperty(e, "__id", { value: ++t }), e.__id }, clone: function (e) { var t = n.util.type(e); switch (t) { case "Object": var a = {}; for (var r in e) e.hasOwnProperty(r) && (a[r] = n.util.clone(e[r])); return a; case "Array": return e.map && e.map(function (e) { return n.util.clone(e) }) }return e } }, languages: { extend: function (e, t) { var a = n.util.clone(n.languages[e]); for (var r in t) a[r] = t[r]; return a }, insertBefore: function (e, t, a, r) { r = r || n.languages; var l = r[e]; if (2 == arguments.length) { a = arguments[1]; for (var i in a) a.hasOwnProperty(i) && (l[i] = a[i]); return l } var o = {}; for (var s in l) if (l.hasOwnProperty(s)) { if (s == t) for (var i in a) a.hasOwnProperty(i) && (o[i] = a[i]); o[s] = l[s] } return n.languages.DFS(n.languages, function (t, n) { n === r[e] && t != e && (this[t] = o) }), r[e] = o }, DFS: function (e, t, a, r) { r = r || {}; for (var l in e) e.hasOwnProperty(l) && (t.call(e, l, e[l], a || l), "Object" !== n.util.type(e[l]) || r[n.util.objId(e[l])] ? "Array" !== n.util.type(e[l]) || r[n.util.objId(e[l])] || (r[n.util.objId(e[l])] = !0, n.languages.DFS(e[l], t, l, r)) : (r[n.util.objId(e[l])] = !0, n.languages.DFS(e[l], t, null, r))) } }, plugins: {}, highlightAll: function (e, t) { var a = { callback: t, selector: 'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code' }; n.hooks.run("before-highlightall", a); for (var r, l = a.elements || document.querySelectorAll(a.selector), i = 0; r = l[i++];)n.highlightElement(r, e === !0, a.callback) }, highlightElement: function (t, a, r) { for (var l, i, o = t; o && !e.test(o.className);)o = o.parentNode; o && (l = (o.className.match(e) || [, ""])[1], i = n.languages[l]), t.className = t.className.replace(e, "").replace(/\s+/g, " ") + " language-" + l, o = t.parentNode, /pre/i.test(o.nodeName) && (o.className = o.className.replace(e, "").replace(/\s+/g, " ") + " language-" + l); var s = t.textContent, u = { element: t, language: l, grammar: i, code: s }; if (!s || !i) return n.hooks.run("complete", u), void 0; if (n.hooks.run("before-highlight", u), a && _self.Worker) { var c = new Worker(n.filename); c.onmessage = function (e) { u.highlightedCode = e.data, n.hooks.run("before-insert", u), u.element.innerHTML = u.highlightedCode, r && r.call(u.element), n.hooks.run("after-highlight", u), n.hooks.run("complete", u) }, c.postMessage(JSON.stringify({ language: u.language, code: u.code, immediateClose: !0 })) } else u.highlightedCode = n.highlight(u.code, u.grammar, u.language), n.hooks.run("before-insert", u), u.element.innerHTML = u.highlightedCode, r && r.call(t), n.hooks.run("after-highlight", u), n.hooks.run("complete", u) }, highlight: function (e, t, r) { var l = n.tokenize(e, t); return a.stringify(n.util.encode(l), r) }, tokenize: function (e, t) { var a = n.Token, r = [e], l = t.rest; if (l) { for (var i in l) t[i] = l[i]; delete t.rest } e: for (var i in t) if (t.hasOwnProperty(i) && t[i]) { var o = t[i]; o = "Array" === n.util.type(o) ? o : [o]; for (var s = 0; s < o.length; ++s) { var u = o[s], c = u.inside, g = !!u.lookbehind, h = !!u.greedy, f = 0, d = u.alias; u = u.pattern || u; for (var p = 0; p < r.length; p++) { var m = r[p]; if (r.length > e.length) break e; if (!(m instanceof a)) { u.lastIndex = 0; var y = u.exec(m), v = 1; if (!y && h && p != r.length - 1) { var b = r[p + 1].matchedStr || r[p + 1], k = m + b; if (p < r.length - 2 && (k += r[p + 2].matchedStr || r[p + 2]), u.lastIndex = 0, y = u.exec(k), !y) continue; var w = y.index + (g ? y[1].length : 0); if (w >= m.length) continue; var _ = y.index + y[0].length, P = m.length + b.length; if (v = 3, P >= _) { if (r[p + 1].greedy) continue; v = 2, k = k.slice(0, P) } m = k } if (y) { g && (f = y[1].length); var w = y.index + f, y = y[0].slice(f), _ = w + y.length, S = m.slice(0, w), O = m.slice(_), j = [p, v]; S && j.push(S); var A = new a(i, c ? n.tokenize(y, c) : y, d, y, h); j.push(A), O && j.push(O), Array.prototype.splice.apply(r, j) } } } } } return r }, hooks: { all: {}, add: function (e, t) { var a = n.hooks.all; a[e] = a[e] || [], a[e].push(t) }, run: function (e, t) { var a = n.hooks.all[e]; if (a && a.length) for (var r, l = 0; r = a[l++];)r(t) } } }, a = n.Token = function (e, t, n, a, r) { this.type = e, this.content = t, this.alias = n, this.matchedStr = a || null, this.greedy = !!r }; if (a.stringify = function (e, t, r) { if ("string" == typeof e) return e; if ("Array" === n.util.type(e)) return e.map(function (n) { return a.stringify(n, t, e) }).join(""); var l = { type: e.type, content: a.stringify(e.content, t, r), tag: "span", classes: ["token", e.type], attributes: {}, language: t, parent: r }; if ("comment" == l.type && (l.attributes.spellcheck = "true"), e.alias) { var i = "Array" === n.util.type(e.alias) ? e.alias : [e.alias]; Array.prototype.push.apply(l.classes, i) } n.hooks.run("wrap", l); var o = ""; for (var s in l.attributes) o += (o ? " " : "") + s + '="' + (l.attributes[s] || "") + '"'; return "<" + l.tag + ' class="' + l.classes.join(" ") + '" ' + o + ">" + l.content + "</" + l.tag + ">" }, !_self.document) return _self.addEventListener ? (_self.addEventListener("message", function (e) { var t = JSON.parse(e.data), a = t.language, r = t.code, l = t.immediateClose; _self.postMessage(n.highlight(r, n.languages[a], a)), l && _self.close() }, !1), _self.Prism) : _self.Prism; var r = document.currentScript || [].slice.call(document.getElementsByTagName("script")).pop(); return r && (n.filename = r.src, document.addEventListener && !r.hasAttribute("data-manual") && document.addEventListener("DOMContentLoaded", n.highlightAll)), _self.Prism }(); "undefined" != typeof module && module.exports && (module.exports = Prism), "undefined" != typeof global && (global.Prism = Prism);
</script>

<script type="text/javascript">
!function (e) { var t = { variable: [{ pattern: /\$?\(\([\w\W]+?\)\)/, inside: { variable: [{ pattern: /(^\$\(\([\w\W]+)\)\)/, lookbehind: !0 }, /^\$\(\(/], number: /\b-?(?:0x[\dA-Fa-f]+|\d*\.?\d+(?:[Ee]-?\d+)?)\b/, operator: /--?|-=|\+\+?|\+=|!=?|~|\*\*?|\*=|\/=?|%=?|<<=?|>>=?|<=?|>=?|==?|&&?|&=|\^=?|\|\|?|\|=|\?|:/, punctuation: /\(\(?|\)\)?|,|;/ } }, { pattern: /\$\([^)]+\)|`[^`]+`/, inside: { variable: /^\$\(|^`|\)$|`$/ } }, /\$(?:[a-z0-9_#\?\*!@]+|\{[^}]+\})/i] }; e.languages.bash = { shebang: { pattern: /^#!\s*\/bin\/bash|^#!\s*\/bin\/sh/, alias: "important" }, comment: { pattern: /(^|[^"{\\])#.*/, lookbehind: !0 }, string: [{ pattern: /((?:^|[^<])<<\s*)(?:"|')?(\w+?)(?:"|')?\s*\r?\n(?:[\s\S])*?\r?\n\2/g, lookbehind: !0, inside: t }, { pattern: /(["'])(?:\\\\|\\?[^\\])*?\1/g, inside: t }], variable: t.variable, "function": { pattern: /(^|\s|;|\||&)(?:alias|apropos|apt-get|aptitude|aspell|awk|basename|bash|bc|bg|builtin|bzip2|cal|cat|cd|cfdisk|chgrp|chmod|chown|chroot|chkconfig|cksum|clear|cmp|comm|command|cp|cron|crontab|csplit|cut|date|dc|dd|ddrescue|df|diff|diff3|dig|dir|dircolors|dirname|dirs|dmesg|du|egrep|eject|enable|env|ethtool|eval|exec|expand|expect|export|expr|fdformat|fdisk|fg|fgrep|file|find|fmt|fold|format|free|fsck|ftp|fuser|gawk|getopts|git|grep|groupadd|groupdel|groupmod|groups|gzip|hash|head|help|hg|history|hostname|htop|iconv|id|ifconfig|ifdown|ifup|import|install|jobs|join|kill|killall|less|link|ln|locate|logname|logout|look|lpc|lpr|lprint|lprintd|lprintq|lprm|ls|lsof|make|man|mkdir|mkfifo|mkisofs|mknod|more|most|mount|mtools|mtr|mv|mmv|nano|netstat|nice|nl|nohup|notify-send|nslookup|open|op|passwd|paste|pathchk|ping|pkill|popd|pr|printcap|printenv|printf|ps|pushd|pv|pwd|quota|quotacheck|quotactl|ram|rar|rcp|read|readarray|readonly|reboot|rename|renice|remsync|rev|rm|rmdir|rsync|screen|scp|sdiff|sed|seq|service|sftp|shift|shopt|shutdown|sleep|slocate|sort|source|split|ssh|stat|strace|su|sudo|sum|suspend|sync|tail|tar|tee|test|time|timeout|times|touch|top|traceroute|trap|tr|tsort|tty|type|ulimit|umask|umount|unalias|uname|unexpand|uniq|units|unrar|unshar|uptime|useradd|userdel|usermod|users|uuencode|uudecode|v|vdir|vi|vmstat|wait|watch|wc|wget|whereis|which|who|whoami|write|xargs|xdg-open|yes|zip)(?=$|\s|;|\||&)/, lookbehind: !0 }, keyword: { pattern: /(^|\s|;|\||&)(?:let|:|\.|if|then|else|elif|fi|for|break|continue|while|in|case|function|select|do|done|until|echo|exit|return|set|declare)(?=$|\s|;|\||&)/, lookbehind: !0 }, "boolean": { pattern: /(^|\s|;|\||&)(?:true|false)(?=$|\s|;|\||&)/, lookbehind: !0 }, operator: /&&?|\|\|?|==?|!=?|<<<?|>>|<=?|>=?|=~/, punctuation: /\$?\(\(?|\)\)?|\.\.|[{}[\];]/ }; var a = t.variable[1].inside; a["function"] = e.languages.bash["function"], a.keyword = e.languages.bash.keyword, a.boolean = e.languages.bash.boolean, a.operator = e.languages.bash.operator, a.punctuation = e.languages.bash.punctuation }(Prism);
</script>

<script type="text/javascript">
!function () { if ("undefined" != typeof self && self.Prism && self.document) { var e = { html: "HTML", xml: "XML", svg: "SVG", mathml: "MathML", css: "CSS", clike: "C-like", javascript: "JavaScript", abap: "ABAP", actionscript: "ActionScript", apacheconf: "Apache Configuration", apl: "APL", applescript: "AppleScript", asciidoc: "AsciiDoc", aspnet: "ASP.NET (C#)", autoit: "AutoIt", autohotkey: "AutoHotkey", basic: "BASIC", csharp: "C#", cpp: "C++", coffeescript: "CoffeeScript", "css-extras": "CSS Extras", fsharp: "F#", glsl: "GLSL", http: "HTTP", inform7: "Inform 7", json: "JSON", latex: "LaTeX", lolcode: "LOLCODE", matlab: "MATLAB", mel: "MEL", nasm: "NASM", nginx: "nginx", nsis: "NSIS", objectivec: "Objective-C", ocaml: "OCaml", parigp: "PARI/GP", php: "PHP", "php-extras": "PHP Extras", powershell: "PowerShell", jsx: "React JSX", rest: "reST (reStructuredText)", sas: "SAS", sass: "Sass (Sass)", scss: "Sass (Scss)", sql: "SQL", typescript: "TypeScript", vhdl: "VHDL", vim: "vim", wiki: "Wiki markup", yaml: "YAML" }; Prism.hooks.add("before-highlight", function (s) { var a = s.element.parentNode; if (a && /pre/i.test(a.nodeName)) { var t, i, r = a.getAttribute("data-language") || e[s.language] || s.language.substring(0, 1).toUpperCase() + s.language.substring(1), l = a.previousSibling; l && /\s*\bprism-show-language\b\s*/.test(l.className) && l.firstChild && /\s*\bprism-show-language-label\b\s*/.test(l.firstChild.className) ? i = l.firstChild : (t = document.createElement("div"), i = document.createElement("div"), i.className = "prism-show-language-label", t.className = "prism-show-language", t.appendChild(i), a.parentNode.insertBefore(t, a)), i.innerHTML = r } }) } }();
</script>

<script type="text/x-mathjax-config">
(function () {

MathJax.Hub.Config({
'showProcessingMessages': false,
'messageStyle': 'none'
});

if (typeof MathJaxListener !== 'undefined') {
MathJax.Hub.Register.StartupHook('End', function () {
MathJaxListener.invokeCallbackForKey_('End');
});
}

})();
</script>

<script type="text/javascript"
src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


</body>

</html>