<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Chapter5</title>


<style type="text/css">
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  /* padding-top: 10px;
  padding-bottom: 10px; */
  background-color: white;
  /* padding: 30px;  */}

/* Style buttons */
.copyButton {
  right: 70px;
  position: absolute; /*positioned relative to its parent element*/
  background-color: none;
  border: none; /* Remove borders */
  color: black; /*  text */
  font-size: 22px; /* Set a font size */
  padding: 0;
  cursor: pointer; /* Mouse pointer on hover */
  background-position-x: 8px;
  background-position-y: 6px;   
}
.yamlTag {
  right: 70px;
  position: absolute; /*positioned relative to its parent element*/
  background-color: none;
  color: grey; /*  text */
  font-size: 18px; /* Set a font size */
  padding: 0;
  margin-top: -4px;
  cursor: auto; /* Mouse pointer on hover */
  background-position-x: 8px;
  background-position-y: 6px;   
}     
/* Darker background on mouse-over */
.copyButton:hover {
  background-color: #CACFD2;
}

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

/* img {
  max-width: 100%; } */

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}

kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb
}

* {
	-webkit-print-color-adjust: exact;
}
/* @media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
} */
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
  body {
    padding: 2cm; 
  }
}
</style>

<style type="text/css">
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #a67f59;
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
</style>

<style type="text/css">
div.prism-show-language {
	position: relative;
}

div.prism-show-language > div.prism-show-language-label {
	color: black;
	background-color: #CFCFCF;
	display: inline-block;
	position: absolute;
	bottom: auto;
	left: auto;
	top: 0;
	right: 0;
	width: auto;
	height: auto;
	font-size: 0.9em;
	border-radius: 0 0 0 5px;
	padding: 0 0.5em;
	text-shadow: none;
	z-index: 1;
	-webkit-box-shadow: none;
	-moz-box-shadow: none;
	box-shadow: none;
	-webkit-transform: none;
	-moz-transform: none;
	-ms-transform: none;
	-o-transform: none;
	transform: none;
}
</style>


</head>

<body>
<p>In this chapter, we will be working with a 3-node infrastructure, a master node with Ansible Engine and 2 worker nodes, one of the worker node will be working as an attacker and the other worker node will be working as the victim, both nodes will be administrated by Ansible. Our main goal is to use Ansible to determine trough an audit any suspicious action in the nodes.</p>

<h2 id="toc_1">5.1 Ansible Configurations</h2>

<h3 id="toc_2">5.1.1 Ansible Ping Job</h3>

<p>Our first task is to SSH into the Ansible Engine and verify connectivy and correctness to the nodes with the following command.</p>

<pre><button ng-click="copyToClipboard('6-1')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ ansible all -m ping</code><code id = "6-1" hidden>ansible all -m ping</code></pre>

<h3 id="toc_3">5.1.2 Describing an Ansible Audit Playbook</h3>

<p>The Ansible Audit Playbook has two goals. First, it will be used to obtain a baseline to understand the initial configuration of the nodes, in our case, only 2 nodes, however this can be easily implemented in several nodes. This first step is pretty common whenever new infrastructure is deployed in a Data Center. Second, the Ansible Audit Playbook will be used to Audit the nodes and obtain a report, that can be used to compare againts the baseline report obtained in the first step. </p>

<p>Our Audit Playbook is taking into consideration the following aspects</p>

<ul>
<li>System data acquisition (type of OS, CPU model, CPU Speed, CPU cores, Physical Memory, Used physical memory, etc.)</li>
<li>Users and groups data acquisition (List of users created after Linux installation, list of users with sudo access, groups, groups with sudo access, etc.)</li>
<li>Storage data acquisition (Installed Physical Disks, partition, and available disk space, filesystem, etc.)</li>
<li>Networking data acquisition (Network devices, routing table, open ports, established SSH connections, daemon logs, active system services, etc.)</li>
</ul>

<h3 id="toc_4">5.1.3 Describing the Ansible Audit Playbook</h3>

<p>Go to the audit directory in our ansible-demo repository: </p>

<pre><button ng-click="copyToClipboard('6-2')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ cd ~/ansible-demo/audit
$ cat audit.yaml</code><code id = "6-2" hidden>cd ~/ansible-demo/audit
cat audit.yaml</code></pre>


<p>The output: </p>

<div><pre><code class="language-bash">---
- name: Audit
  user: ansibledevops
  hosts: node1
  become: yes

  vars:
    - destination: /home/ec2-user/ansible-demo/audit/baseline.txt
  tasks:

    - name: Create a file
      file:
        dest: &quot;\{\{ destination \}\}&quot;
        state: touch
      delegate_to: localhost

    - name: Hostname
      shell:
        hostname
      register: hostname
    - debug:
        msg: &quot;\{\{hostname.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== HOSTNAME ==========&quot;
        insertafter: OEF
      delegate_to: localhost


    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{hostname.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost


    - name: Current date and time
      shell:
        date
      register: date
    - debug:
        msg: &quot;\{\{date.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== DATE ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{date.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: Operating System Information
      shell:
        cat /etc/os-release
      register: os_info
    - debug:
        msg: &quot;\{\{os_info.stdout_lines\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== OPERATING SYSTEM ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{os_info.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: System Uptime
      shell:
        uptime
      register: uptime
    - debug:
        msg: &quot;\{\{uptime.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== SYSTEM UPTIME ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{uptime.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost
        
    - name: CPU Model
      shell:
        cat /proc/cpuinfo | grep name | cut -d&#39;:&#39; -f2
      register: cpumodel
    - debug:
        msg: &quot;\{\{cpumodel.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== CPU MODEL ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{cpumodel.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: CPU Speed
      shell:
        cat /proc/cpuinfo | grep MHz | cut -d&#39;:&#39; -f2
      register: cpuspeed
    - debug:
        msg: &quot;\{\{cpuspeed.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== CPU SPEED ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{cpuspeed.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: CPU Cores
      shell:
        cat /proc/cpuinfo | grep cores | cut -d&#39;:&#39; -f2
      register: cpucores
    - debug:
        msg: &quot;\{\{cpucores.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== CPU CORES  ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{cpucores.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: Total Physicall Memory
      shell:
        free -m | grep Mem | tr -s &#39; &#39; | cut -d &#39; &#39; -f2
      register: totalmemory
    - debug:
        msg: &quot;\{\{totalmemory.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== TOTAL PHYSICAL MEMORY ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{totalmemory.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: Used Physicall Memory
      shell:
        free -m | grep Mem | tr -s &#39; &#39; | cut -d &#39; &#39; -f3
      register: usedmemory
    - debug:
        msg: &quot;\{\{usedmemory.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== USED PHYSICAL MEMORY ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{usedmemory.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: List of users created after Linux installation
      shell:
        &quot; awk -F: &#39;($3&gt;999 &amp;&amp; $3&lt;65534) {print $1}&#39; /etc/passwd &quot;
      register: userslist
    - debug:
        msg: &quot;\{\{userslist.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== LIST OF USERS CREATED AFTER LINUS INSTALLATION ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{userslist.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: List of users with Sudo access
      shell:
        &quot; sudo grep &#39;^sudo:.*$&#39; /etc/group | cut -d: -f4 &quot;
      register: usersWithSudoAccess
    - debug:
        msg: &quot;\{\{usersWithSudoAccess.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== LIST OF USERS WITH SUDO ACCESS ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{usersWithSudoAccess.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: Groups information
      shell:
        &quot; awk -F: &#39;($3&gt;999 &amp;&amp; $3&lt;65534) {print $1 $3 $4}&#39; /etc/group &quot;
      register: GroupsInformation
    - debug:
        msg: &quot;\{\{GroupsInformation.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== GROUPS INFORMATION ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{GroupsInformation.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: Groups in Sudoers
      shell:
        &quot; sudo cat /etc/sudoers | awk &#39;{print $1}&#39; | grep % &quot;
      register: GroupsInSudoers
    - debug:
        msg: &quot;\{\{GroupsInSudoers.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== GROUPS IN SUDOERS ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{GroupsInSudoers.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: Information on the installed physical disks on a system
      shell:
        &quot; sudo fdisk -l | head -2 | grep Disk &quot;
      register: installedPhysicalDisks
    - debug:
        msg: &quot;\{\{installedPhysicalDisks.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== HARD DISK INFORMATION  ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{installedPhysicalDisks.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: Information on the installed physical partitions on a system
      shell:
        sudo fdisk -l | tail -8 | awk &#39;/dev/ { print $1 &quot; &quot; $5 &quot; &quot; $7 }&#39;
      register: installedPhysicalPartitions
    - debug:
        msg: &quot;\{\{installedPhysicalPartitions.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== HARD DISK PARTITION&#39;S INFORMATION  ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{installedPhysicalPartitions.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost
        
    - name: Information on the available free disk space on a system
      shell:
        sudo df -h | awk &#39;{if ($1 != &quot;Filesystem&quot; &amp;&amp; $1 != &quot;none&quot;) print $1 &quot; &quot; $5}&#39;
      register: availableFreeDiskSpace
    - debug:
        msg: &quot;\{\{availableFreeDiskSpace.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== HARD DISK INFORMATION (Free disk space)  ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{availableFreeDiskSpace.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: IP Addresses
      shell:
        &quot; ifconfig | grep broadcast | tr -s &#39; &#39; | cut -d&#39; &#39; -f3 &quot;
      register: IPAddresses
    - debug:
        msg: &quot;\{\{IPAddresses.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== NETWORK DEVICES &amp; IP ADDRESSES  ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{IPAddresses.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: IP Routing Table
      shell:
        route
      register: IPRoutingTable
    - debug:
        msg: &quot;\{\{IPRoutingTable.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== ROUTING TABLE  ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{IPRoutingTable.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: Install Nmap
      yum:
        name:
          - nmap
        state: latest

    - name: Scanning Open Ports
      shell:
        nmap -sT -p- 127.0.0.1 | sed 1,4d
      register: ScanningOpenPorts
    - debug:
        msg: &quot;\{\{ScanningOpenPorts.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== OPEN PORTS  ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{ScanningOpenPorts.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: Audit Established SSH connections
      shell:
        sudo lsof -i -n -P | grep sshd | grep IPv4 | grep ESTABLISHED
      register: AuditSSHConnections
    - debug:
        msg: &quot;\{\{AuditSSHConnections.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== AUDIT SSH CONNECTIONS  ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{AuditSSHConnections.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: Audit Daemons logs
      shell:
        sudo aureport -ts this-month -te now --summary -i | grep failed
      register: AuditDaemonsLogs
    - debug:
        msg: &quot;\{\{AuditDaemonsLogs.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== AUDIT DAEMON LOGS  ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;\{\{AuditDaemonsLogs.stdout\}\}&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: List System services
      shell:
        sudo systemctl list-units --type=service | grep running
      register: ListSystemServices
    - debug:
        msg: &quot;\{\{ListSystemServices.stdout\}\}&quot;

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;========== LIST SYSTEM SERVICES  ==========&quot;
        insertafter: OEF
      delegate_to: localhost

    - name: append
      lineinfile:
        dest: &quot;\{\{ destination \}\}&quot;
        line: &quot;{{ListSystemServices.stdout}}&quot;
        insertafter: OEF
      delegate_to: localhost

 </code></pre></div>


<p>The previous Ansible Playbook take into consideration characteristics described in Step 5.1.2.</p>

<h3 id="toc_5">5.1.4 Update Ansible configuration file </h3>

<p>Update the &quot;private<em>key</em>file&quot; variable to use your own private key by changing &quot;Your<em>Private</em>Key&quot; to your own value. In the below command, change the 2nd &quot;Your<em>Private</em>Key&quot; to your own private key name.</p>

<div><pre><code class="language-bash">$ sed -i &#39;s&amp;private_key_file = /home/ec2-user/.ssh/&quot;Your_Private_Key&quot;&amp;private_key_file = /home/ec2-user/.ssh/&quot;Your_Private_Key&quot;&amp;g&#39; ansible.cfg</code><code id = "6-3" hidden>sed -i &#39;s&amp;private_key_file = /home/ec2-user/.ssh/&quot;Your_Private_Key&quot;&amp;private_key_file = /home/ec2-user/.ssh/&quot;Your_Private_Key&quot;&amp;g&#39; ansible.cfg</code></pre></div>

<p>For example, in my case (my private key is &quot;id_rsa&quot;): </p>

<div><pre><code class="language-bash">$ sed -i &#39;s&amp;private_key_file = /home/ec2-user/.ssh/&quot;Your_Private_Key&quot;&amp;private_key_file = /home/ec2-user/.ssh/id_rsa&amp;g&#39; ansible.cfg</code><code id = "6-4" hidden>sed -i &#39;s&amp;private_key_file = /home/ec2-user/.ssh/&quot;Your_Private_Key&quot;&amp;private_key_file = /home/ec2-user/.ssh/id_rsa&amp;g&#39; ansible.cfg</code></pre></div>

<p>Or, if the command above is confusing you, just do the following: </p>

<pre><button ng-click="copyToClipboard('6-5')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ vim ansible.cfg</code><code id = "6-5" hidden>vim ansible.cfg</code></pre>


<p>And manually update the value &quot;Your<em>Private</em>Key&quot; in the last line to the name of your private key. </p>

<p>This is an exemplary output</p>

<p align="center"> <img src="/MizzouCloudDevOps/img/lab6/chapter5-13.png" width="500px"></p>

<p>As with any other Ansible playbook a good practice is to verify the correctness of the playbook with the syntax check.</p>

<pre><button ng-click="copyToClipboard('6-6')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ ansible-playbook --syntax-check audit.yaml</code><code id = "6-6" hidden>ansible-playbook --syntax-check audit.yaml</code></pre>


<h3 id="toc_6">5.1.6 Executing the Playbook to obtain baselines</h3>

<p><em>Node1</em> will play the Victim role and node the Attacker role. We are going to gather baseline information from <em>node1</em> through the Ansible Audit Playbook execution, then we are going to attack the victim and finally we are going to gather again information from <em>node1</em> in order to compare results and analize the output.</p>

<p align="center"> <img src="/MizzouCloudDevOps/img/lab6/chapter5-16.png" width="500px"></p>

<p>By executing the following command we are going to gather information from <em>node1</em> into the baseline.txt file as an initial baseline and will be used later for comparission once the Playbook is executed again, after an attack.</p>

<pre><button ng-click="copyToClipboard('6-7')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ ansible-playbook audit.yaml</code><code id = "6-7" hidden>ansible-playbook audit.yaml</code></pre>


<h3 id="toc_7">5.1.7 Cybersecurity scenario</h3>

<p>Our small infrastructure has purposely 2 nodes. First, we are going to make <em>node1</em> vulnerable by executing a script that will:</p>

<ul>
<li>Create different user accounts</li>
<li>Create a group named <em>attack</em> and make new users part of it.</li>
<li>Assign to the new group all the permission in the system so users who belong to that group will be able to execute <em>sudo</em> commands.</li>
<li>Collect internal data into a file.</li>
<li>Move the collected data to node2.</li>
</ul>

<p>On the other hand, <em>node2</em> is going to receive the collected data from <em>node1</em>. Let&#39;s see first the bash script that needs to be executed in <em>node1</em>. Of course there are multiple methods to trick users in <em>node1</em> to download and execute the script, we are going to do it manually.</p>

<p>SSH to <em>node1</em>. </p>

<pre><button ng-click="copyToClipboard('6-8')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ ssh -i &quot;Path/Your_Private_Key&quot; ansibledevops@&quot;Your_Instance_Public_IP&quot;</code><code id = "6-8" hidden>ssh -i &quot;Path/Your_Private_Key&quot; ansibledevops@&quot;Your_Instance_Public_IP&quot;</code></pre>


<p>Create a bash script in the home directory, name it attacker.sh</p>


<pre><button ng-click="copyToClipboard('6-9')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ cd ~
$ vim attacker.sh</code><code id = "6-9" hidden>cd ~
vim attacker.sh</code></pre>

<p>Copy the content below on it.</p>

<pre><button ng-click="copyToClipboard('6-10')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">#!/bin/bash
###################FEDORA FAMILY#######################
#Script to be executed in a EC2 instance
#Creating user accounts
#input file requires 2 columns: username and password
file=&quot;users.txt&quot;
sudo groupadd attack
while read user password ;
do
        echo Creating $user
        sudo adduser $user
        sudo usermod -aG attack $user
        echo $password | sudo passwd --stdin $user
        sleep 1
done &lt; &quot;$file&quot;

# Allow the attack group execute the yum command
echo &quot;%attack  ALL=(ALL) NOPASSWD: /usr/bin/yum&quot; | sudo EDITOR=&#39;tee -a&#39; visudo
sudo chown :attack /etc/sudoers

#Install and start additional services in default ports
sudo yum install vsftpd -y
sudo systemctl start vsftpd</code><code id = "6-10" hidden>#!/bin/bash
###################FEDORA FAMILY#######################
#Script to be executed in a EC2 instance
#Creating user accounts
#input file requires 2 columns: username and password
file=&quot;users.txt&quot;
sudo groupadd attack
while read user password ;
do
        echo Creating $user
        sudo adduser $user
        sudo usermod -aG attack $user
        echo $password | sudo passwd --stdin $user
        sleep 1
done &lt; &quot;$file&quot;

# Allow the attack group execute the yum command
echo &quot;%attack  ALL=(ALL) NOPASSWD: /usr/bin/yum&quot; | sudo EDITOR=&#39;tee -a&#39; visudo
sudo chown :attack /etc/sudoers

#Install and start additional services in default ports
sudo yum install vsftpd -y
sudo systemctl start vsftpd</code></pre>


<p>Before executing our script, we also need to create a <em>users.txt</em> file that will contain two columns separated by and empty space, the first column will specify the username and the second one will specify the password.</p>

<p>Below is and example of the file that also needs to be created in the home directory.</p>

<pre><button ng-click="copyToClipboard('6-11')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ cat users.txt
user1 1234
user2 123456
user3 qwerty</code><code id = "6-11" hidden>cat users.txt</code></pre>


<p>Execute the bash script with the following command</p>


<pre><button ng-click="copyToClipboard('6-12')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ sudo bash ~/attacker.sh
$ exit</code><code id = "6-12" hidden>sudo bash ~/attacker.sh
exit</code></pre>


<p>Now that the attack was executed in <em>node1</em>, we need to use our Audit Playbook in the <em>Ansible Controller</em> to collect data into a second file <em>data.txt</em>.</p>

<p align="center"> <img src="/MizzouCloudDevOps/img/lab6/chapter5-18.png" width="500px"></p>


<pre><button ng-click="copyToClipboard('6-13')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ ansible-playbook audit.yaml</code><code id = "6-13" hidden>ansible-playbook audit.yaml</code></pre>


<p>Finally we will compare both files to see differences and analyse the output.</p>


<pre><button ng-click="copyToClipboard('6-14')" type="button" class="copyButton"><i class="fa fa-files-o"></i></button><code class="language-bash">$ diff baseline.txt data.txt</code><code id = "6-14" hidden>diff baseline.txt data.txt</code></pre>

<p>Let&#39;s pay attention the below output, section &#39;List of users created after Linux Installation&#39;. Notice that the output on the left belongs to the baseline.txt file and it shows only 2 users created. However, the output on the left belongs to the data.txt file, and it shows that 3 additional users were created and all of them belong to a new group named: attack. This output will greatly help us to understand better the changes a system had in the initial configuration.</p>

<p align="center"> <img src="/MizzouCloudDevOps/img/lab6/chapter5-18a.png" width="500px"></p>



<h2 id="toc_1">5.2 Summary</h2>

<p>Ansible allows you to simply define your systems for security. Ansible&#39;s easily understood Playbook syntax allows you to define secure any part of your system, whether it&#39;s setting firewall rules, locking down users and groups, or applying custom security policies. There are a lot more concepts/components that Ansible contains but we did not include in this lab. However, if you are interested, please use the following Ansible Galaxy link that is the Ansibleâ€™s official hub for sharing Ansible content.</p>

<ul>
<li>Website: https://galaxy.ansible.com/</li>
</ul>

<p>Once you have completed the lab, please terminate all the EC2 instances that you created for this lab.</p>


<script type="text/javascript">
var _self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{},Prism=function(){var e=/\blang(?:uage)?-(\w+)\b/i,t=0,n=_self.Prism={util:{encode:function(e){return e instanceof a?new a(e.type,n.util.encode(e.content),e.alias):"Array"===n.util.type(e)?e.map(n.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++t}),e.__id},clone:function(e){var t=n.util.type(e);switch(t){case"Object":var a={};for(var r in e)e.hasOwnProperty(r)&&(a[r]=n.util.clone(e[r]));return a;case"Array":return e.map&&e.map(function(e){return n.util.clone(e)})}return e}},languages:{extend:function(e,t){var a=n.util.clone(n.languages[e]);for(var r in t)a[r]=t[r];return a},insertBefore:function(e,t,a,r){r=r||n.languages;var l=r[e];if(2==arguments.length){a=arguments[1];for(var i in a)a.hasOwnProperty(i)&&(l[i]=a[i]);return l}var o={};for(var s in l)if(l.hasOwnProperty(s)){if(s==t)for(var i in a)a.hasOwnProperty(i)&&(o[i]=a[i]);o[s]=l[s]}return n.languages.DFS(n.languages,function(t,n){n===r[e]&&t!=e&&(this[t]=o)}),r[e]=o},DFS:function(e,t,a,r){r=r||{};for(var l in e)e.hasOwnProperty(l)&&(t.call(e,l,e[l],a||l),"Object"!==n.util.type(e[l])||r[n.util.objId(e[l])]?"Array"!==n.util.type(e[l])||r[n.util.objId(e[l])]||(r[n.util.objId(e[l])]=!0,n.languages.DFS(e[l],t,l,r)):(r[n.util.objId(e[l])]=!0,n.languages.DFS(e[l],t,null,r)))}},plugins:{},highlightAll:function(e,t){var a={callback:t,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};n.hooks.run("before-highlightall",a);for(var r,l=a.elements||document.querySelectorAll(a.selector),i=0;r=l[i++];)n.highlightElement(r,e===!0,a.callback)},highlightElement:function(t,a,r){for(var l,i,o=t;o&&!e.test(o.className);)o=o.parentNode;o&&(l=(o.className.match(e)||[,""])[1],i=n.languages[l]),t.className=t.className.replace(e,"").replace(/\s+/g," ")+" language-"+l,o=t.parentNode,/pre/i.test(o.nodeName)&&(o.className=o.className.replace(e,"").replace(/\s+/g," ")+" language-"+l);var s=t.textContent,u={element:t,language:l,grammar:i,code:s};if(!s||!i)return n.hooks.run("complete",u),void 0;if(n.hooks.run("before-highlight",u),a&&_self.Worker){var c=new Worker(n.filename);c.onmessage=function(e){u.highlightedCode=e.data,n.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(u.element),n.hooks.run("after-highlight",u),n.hooks.run("complete",u)},c.postMessage(JSON.stringify({language:u.language,code:u.code,immediateClose:!0}))}else u.highlightedCode=n.highlight(u.code,u.grammar,u.language),n.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(t),n.hooks.run("after-highlight",u),n.hooks.run("complete",u)},highlight:function(e,t,r){var l=n.tokenize(e,t);return a.stringify(n.util.encode(l),r)},tokenize:function(e,t){var a=n.Token,r=[e],l=t.rest;if(l){for(var i in l)t[i]=l[i];delete t.rest}e:for(var i in t)if(t.hasOwnProperty(i)&&t[i]){var o=t[i];o="Array"===n.util.type(o)?o:[o];for(var s=0;s<o.length;++s){var u=o[s],c=u.inside,g=!!u.lookbehind,h=!!u.greedy,f=0,d=u.alias;u=u.pattern||u;for(var p=0;p<r.length;p++){var m=r[p];if(r.length>e.length)break e;if(!(m instanceof a)){u.lastIndex=0;var y=u.exec(m),v=1;if(!y&&h&&p!=r.length-1){var b=r[p+1].matchedStr||r[p+1],k=m+b;if(p<r.length-2&&(k+=r[p+2].matchedStr||r[p+2]),u.lastIndex=0,y=u.exec(k),!y)continue;var w=y.index+(g?y[1].length:0);if(w>=m.length)continue;var _=y.index+y[0].length,P=m.length+b.length;if(v=3,P>=_){if(r[p+1].greedy)continue;v=2,k=k.slice(0,P)}m=k}if(y){g&&(f=y[1].length);var w=y.index+f,y=y[0].slice(f),_=w+y.length,S=m.slice(0,w),O=m.slice(_),j=[p,v];S&&j.push(S);var A=new a(i,c?n.tokenize(y,c):y,d,y,h);j.push(A),O&&j.push(O),Array.prototype.splice.apply(r,j)}}}}}return r},hooks:{all:{},add:function(e,t){var a=n.hooks.all;a[e]=a[e]||[],a[e].push(t)},run:function(e,t){var a=n.hooks.all[e];if(a&&a.length)for(var r,l=0;r=a[l++];)r(t)}}},a=n.Token=function(e,t,n,a,r){this.type=e,this.content=t,this.alias=n,this.matchedStr=a||null,this.greedy=!!r};if(a.stringify=function(e,t,r){if("string"==typeof e)return e;if("Array"===n.util.type(e))return e.map(function(n){return a.stringify(n,t,e)}).join("");var l={type:e.type,content:a.stringify(e.content,t,r),tag:"span",classes:["token",e.type],attributes:{},language:t,parent:r};if("comment"==l.type&&(l.attributes.spellcheck="true"),e.alias){var i="Array"===n.util.type(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(l.classes,i)}n.hooks.run("wrap",l);var o="";for(var s in l.attributes)o+=(o?" ":"")+s+'="'+(l.attributes[s]||"")+'"';return"<"+l.tag+' class="'+l.classes.join(" ")+'" '+o+">"+l.content+"</"+l.tag+">"},!_self.document)return _self.addEventListener?(_self.addEventListener("message",function(e){var t=JSON.parse(e.data),a=t.language,r=t.code,l=t.immediateClose;_self.postMessage(n.highlight(r,n.languages[a],a)),l&&_self.close()},!1),_self.Prism):_self.Prism;var r=document.currentScript||[].slice.call(document.getElementsByTagName("script")).pop();return r&&(n.filename=r.src,document.addEventListener&&!r.hasAttribute("data-manual")&&document.addEventListener("DOMContentLoaded",n.highlightAll)),_self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism),"undefined"!=typeof global&&(global.Prism=Prism);
</script>

<script type="text/javascript">
!function(e){var t={variable:[{pattern:/\$?\(\([\w\W]+?\)\)/,inside:{variable:[{pattern:/(^\$\(\([\w\W]+)\)\)/,lookbehind:!0},/^\$\(\(/],number:/\b-?(?:0x[\dA-Fa-f]+|\d*\.?\d+(?:[Ee]-?\d+)?)\b/,operator:/--?|-=|\+\+?|\+=|!=?|~|\*\*?|\*=|\/=?|%=?|<<=?|>>=?|<=?|>=?|==?|&&?|&=|\^=?|\|\|?|\|=|\?|:/,punctuation:/\(\(?|\)\)?|,|;/}},{pattern:/\$\([^)]+\)|`[^`]+`/,inside:{variable:/^\$\(|^`|\)$|`$/}},/\$(?:[a-z0-9_#\?\*!@]+|\{[^}]+\})/i]};e.languages.bash={shebang:{pattern:/^#!\s*\/bin\/bash|^#!\s*\/bin\/sh/,alias:"important"},comment:{pattern:/(^|[^"{\\])#.*/,lookbehind:!0},string:[{pattern:/((?:^|[^<])<<\s*)(?:"|')?(\w+?)(?:"|')?\s*\r?\n(?:[\s\S])*?\r?\n\2/g,lookbehind:!0,inside:t},{pattern:/(["'])(?:\\\\|\\?[^\\])*?\1/g,inside:t}],variable:t.variable,"function":{pattern:/(^|\s|;|\||&)(?:alias|apropos|apt-get|aptitude|aspell|awk|basename|bash|bc|bg|builtin|bzip2|cal|cat|cd|cfdisk|chgrp|chmod|chown|chroot|chkconfig|cksum|clear|cmp|comm|command|cp|cron|crontab|csplit|cut|date|dc|dd|ddrescue|df|diff|diff3|dig|dir|dircolors|dirname|dirs|dmesg|du|egrep|eject|enable|env|ethtool|eval|exec|expand|expect|export|expr|fdformat|fdisk|fg|fgrep|file|find|fmt|fold|format|free|fsck|ftp|fuser|gawk|getopts|git|grep|groupadd|groupdel|groupmod|groups|gzip|hash|head|help|hg|history|hostname|htop|iconv|id|ifconfig|ifdown|ifup|import|install|jobs|join|kill|killall|less|link|ln|locate|logname|logout|look|lpc|lpr|lprint|lprintd|lprintq|lprm|ls|lsof|make|man|mkdir|mkfifo|mkisofs|mknod|more|most|mount|mtools|mtr|mv|mmv|nano|netstat|nice|nl|nohup|notify-send|nslookup|open|op|passwd|paste|pathchk|ping|pkill|popd|pr|printcap|printenv|printf|ps|pushd|pv|pwd|quota|quotacheck|quotactl|ram|rar|rcp|read|readarray|readonly|reboot|rename|renice|remsync|rev|rm|rmdir|rsync|screen|scp|sdiff|sed|seq|service|sftp|shift|shopt|shutdown|sleep|slocate|sort|source|split|ssh|stat|strace|su|sudo|sum|suspend|sync|tail|tar|tee|test|time|timeout|times|touch|top|traceroute|trap|tr|tsort|tty|type|ulimit|umask|umount|unalias|uname|unexpand|uniq|units|unrar|unshar|uptime|useradd|userdel|usermod|users|uuencode|uudecode|v|vdir|vi|vmstat|wait|watch|wc|wget|whereis|which|who|whoami|write|xargs|xdg-open|yes|zip)(?=$|\s|;|\||&)/,lookbehind:!0},keyword:{pattern:/(^|\s|;|\||&)(?:let|:|\.|if|then|else|elif|fi|for|break|continue|while|in|case|function|select|do|done|until|echo|exit|return|set|declare)(?=$|\s|;|\||&)/,lookbehind:!0},"boolean":{pattern:/(^|\s|;|\||&)(?:true|false)(?=$|\s|;|\||&)/,lookbehind:!0},operator:/&&?|\|\|?|==?|!=?|<<<?|>>|<=?|>=?|=~/,punctuation:/\$?\(\(?|\)\)?|\.\.|[{}[\];]/};var a=t.variable[1].inside;a["function"]=e.languages.bash["function"],a.keyword=e.languages.bash.keyword,a.boolean=e.languages.bash.boolean,a.operator=e.languages.bash.operator,a.punctuation=e.languages.bash.punctuation}(Prism);
</script>


</body>

</html>
