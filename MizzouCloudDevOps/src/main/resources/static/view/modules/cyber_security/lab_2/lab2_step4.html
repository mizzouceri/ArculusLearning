<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>page3</title>


<style type="text/css">
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  /* padding-top: 10px;
  padding-bottom: 10px; */
  background-color: white;
  /* padding: 30px;  */}

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

/* img {
  max-width: 100%; } */

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}

kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb
}

* {
	-webkit-print-color-adjust: exact;
}
/* @media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
} */
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
  body {
    padding: 2cm; 
  }
}
</style>

<style type="text/css">
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #a67f59;
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
</style>


</head>

<body>


<p>You will use Docker containers and Docker-compose to setup your topology in this lab.</p>

<h2 id="toc_2">3.1 Creating your customized Docker images</h2>

<h3 id="toc_3">3.1.1 Controller node.</h3>

<p>On the Controller node, you will install Dolus System that runs the Frenetic SDN controller. The controller is used to store the network traffic packet data collected on the Root Switch and Slave Switch, analyze the data and calculate the suspiciousness scores, and detect an attack.</p>

<p>We have prepared the Controller node as a Docker container, and installed all the required software and libraries. You will just need to install the Dolus Admin UI, and configure the node to connect to the Root Switch and Slave Switch. This will need to be done after you correctly configure the two switches. To configure the Controller, please follow the steps below:</p>

<ul>
<li><p>Download the Controller Docker container image</p>

<div><pre><code class="language-bash">$ docker pull mizzouceri/dolus-controller:devops</code></pre></div>

<blockquote style = "background-color: #e5f5e0 ; margin: 0 ; font-family: calibri;border: 2px solid #00441b; border-left: 6px solid #00441b; padding : 0.5em; border-radius: 8px; background-style:discrete" >
<font size = 3 color = green> <b> Note: </b></font>
This step will be done automatically during our later docker-compose step if the image is not present on your EC instance. But doing it here can save you some waiting time while you are going through the below sections. </blockquote>

<p>In this Docker image, we have pre-installed Open vSwitch ver 2.11.0, since it will take a lot of efforts to install it on your own, and it is really error prone. In addition, we have installed other required software/libraries, e.g. MySQL, sqlalchemy, Frenetic, PHP 7.2, and etc.</p></li>
<li><p>Create your customized Controller image</p>

<p>You will use the downloaded Docker image and the Dockerfile shown below to create your customized Docker image for the Controller node by installing Dolus system.</p>

<div><pre><code class="language-bash">$ cd ~/Dolus-SDN-demo/controller
$ cat Dockerfile</code></pre></div>

<p>Output:</p>

<div><pre><code class="language-docker">FROM mizzouceri/dolus-controller:devops
RUN mv /var/www/html /var/www/public_html
RUN git clone https://github.com/wangso/Dolus_DDos.git /var/www/public_html/Dolus_DDos
RUN chmod -R 777 /var/www/ &amp;&amp; chmod -R 774 /var/www/public_html/Dolus_DDos
WORKDIR /var/www/public_html/Dolus_DDos
RUN composer install \
&amp;&amp; chmod -R 755 /var/www/public_html/Dolus_DDos \
&amp;&amp; chmod -R 777 storage \
&amp;&amp; chmod -R 775 .env \
&amp;&amp; php artisan key:generate</code></pre></div>

<p>You do not need to build your customized image yet. Instead, we will use docker-compose to automate the process
in later section.</p>

<blockquote style = "background-color: #e5f5e0 ; margin: 0 ; font-family: calibri;border: 2px solid #00441b; border-left: 6px solid #00441b; padding : 0.5em; border-radius: 8px; background-style:discrete" >
<font size = 3 color = green> <b> Note: </b></font>
The Controller Docker image and container will take 10GB of space. Plus there are images/containers for other nodes in the topology. Make sure your VM instance has enough storage space available, and then continue to setup the lab environment. </blockquote></li>
</ul>

<h3 id="toc_4">3.1.2 General installation of Open vSwitch</h3>

<p>Other than the Controller node, all the other nodes in our Dolus topology need to be configured as SDN switches that use VXLAN to configure SDN connections among the nodes. To install Open vSwitch, we used the installation release that can be found fromInstalling Open vSwitch. In this lab, we use the Open vSwitch ver 2.11.0. We compiled a bash script to install Open vSwitch in a Docker container running Debian 10 Buster operating system is as follows.
Interested users can try to install Open vSwitch in a Docker container on your own. For this lab, we have prepared a Docker image that has Open vSwitch installed so you can use right away, and save the efforts to install it on your own.</p>

<p>The general script to install Open vSwitch:</p>

<p># ovs-install.sh</p>

<div><pre><code class="language-bash">#!/bin/bash
apt -y update &amp;&amp; apt -y upgrade
apt -y install git automake autoconf gcc uml-utilities libtool build-essential pkg-config iperf screen python3-pip
wget

# install open vSwitch
mkdir /local &amp;&amp; cd /local
wget http://openvswitch.org/releases/openvswitch-2.11.0.tar.gz
tar xvfz openvswitch-2.11.0.tar.gz
cd openvswitch-2.11.0/
./boot.sh
./configure --disable-ssl --disable-libcapng
make
make install
make modules_install
modprobe openvswitch

# create necessary directories for Open vSwitch
mkdir -p /usr/local/etc/openvswitch
mkdir -p /usr/local/var/run/openvswitch
mkdir -p /usr/local/var/log/openvswitch

# init database
ovsdb-tool create /usr/local/etc/openvswitch/conf.db /local/openvswitch-2.11.0/vswitchd/vswitch.ovsschema

# run ovs database
ovsdb-server -v --log-file --pidfile --remote=punix:/usr/local/var/run/openvswitch/db.sock &gt;/var/log/ovsdb.log
2&gt;&amp;1 &amp;

# run ovs switch
ovs-vswitchd --pidfile &gt;/var/log/vswitchd.log 2&gt;&amp;1 &amp;</code></pre></div>

<p>In this script, we first update the Linux OS to update software packages. We then will install several dependencies for running Open vSwitch. Then we download the OVS ver2.11.0 installation package, extract files, and compile and install the package. For vSwitch to store data and logs, we also need to create directories and files for database. At the end, we initialize database and start running the vSwitch.</p>

<h3 id="toc_5">3.1.3 The rest of the topology</h3>

<p>You will use the pre-built Docker image to build your own customized image for all the rest of the nodes in the topology (except the Controller). Download the base Docker image to use for other nodes:</p>

<div><pre><code class="language-bash">$ docker pull mizzouceri/ovs-base:latest</code></pre></div>

<blockquote style = "background-color: #e5f5e0 ; margin: 0 ; font-family: calibri;border: 2px solid #00441b; border-left: 6px solid #00441b; padding : 0.5em; border-radius: 8px; background-style:discrete" >
    <font size = 3 color = green> <b> Note: </b></font>
This step will be done automatically during our later docker-compose step if the base image is not present on your EC2 instance. But doing it here can save you some waiting time while you are going through the below sections. </blockquote>

<h2 id="toc_6">3.2 Build and start the topology using docker-compose</h2>

<p>We will use docker-compose to build all the Docker images for all the nodes in our topology, and automatically create Docker containers for them.</p>

<h3 id="toc_7">3.2.1 Docker-compose configuration</h3>

<div><pre><code class="language-bash">$ cd ~/Dolus-SDN-demo
$ cat docker-compose.yaml</code></pre></div>

<p>Output:</p>

<div><pre><code class="language-yaml"># docker-compose.yaml
version: &quot;3&quot;

services:
    controller:
        build: ./controller
        image: controller:latest
        container_name: controller
        tty: true
        network_mode: host
        privileged: true
        restart: always
        ports:
        - 3306:3306
        - 33060:33060
        - 80:80
        - 6633:6633

    rootSwitch:
        build: ./root-switch
        image: rootswitch:latest
        container_name: rootswitch
        tty: true
        restart: always
        privileged: true
        networks:
            localNet:
            ipv4_address: 172.18.0.3

    slaveSwitch:
        build: ./slave-switch
        image: slaveswitch:latest
        container_name: slaveswitch
        tty: true
        restart: always
        privileged: true
        networks:
        localNet:
        ipv4_address: 172.18.0.4

    server:
        build: ./server
        image: server:latest
        container_name: server
        restart: always
        tty: true
        privileged: true
        networks:
            localNet:
                ipv4_address: 172.18.0.5

    attacker:
        build: ./attacker
        image: attacker:latest
        container_name: attacker
        restart: always
        tty: true
        privileged: true
        networks:
            localNet:
                ipv4_address: 172.18.0.6

    qvm:
        build: ./qvm
        image: qvm:latest
        container_name: qvm
        restart: always
        tty: true
        privileged: true
        networks:
            localNet:
                ipv4_address: 172.18.0.7

    user:
        build: ./user
        image: user:latest
        container_name: user
        restart: always
        tty: true
        privileged: true
        networks:
            localNet:
                ipv4_address: 172.18.0.8

    networks:
        localNet:
            ipam:
                config:
                - subnet: 172.18.0.0/24</code></pre></div>

<p>In this docker-compose configuration manifest, we create a topology that consists all the 7 nodes for our Dolus system setup. We also create a local Docker network (172.18.0.0/24) to run these nodes (except the Controller which is running on the host network) in. Each of the nodes is given a local IP that we will use to build the VXLAN virtual network. For each of the nodes, we build a customized image using their individual directory inside the GitHub repo, and specify the name of the image to build, the name of the container to run. We also grant “privileged” to the user of the containers to fully leverage the Linux kernel and network capabilities for this lab.</p>

<h3 id="toc_8">3.2.2 Start the docker-compose topology</h3>

<p>With the docker-compose configuration in place, we can create our topology by running:</p>

<div><pre><code class="language-bash">$ cd ~/Dolus-SDN-demo
$ docker-compose up -d --build</code></pre></div>

<p>We run “docker-compose up” command with the “-d” option to run the containers detached, and the “–build” option to explicitly build brand new images using our configuration.</p>

<p>You will notice that docker-compose first builds all the customized images using our template and configurations, and then start all the services by creating Docker containers for each of the nodes.</p>

<p align="center"> <img src="/MizzouCloudDevOps/img/lab2/compose-1.png" width="800px"> </p>

<p>At the end of the process, you will see that all container images are built.</p>

<p align="center"> <img src="/MizzouCloudDevOps/img/lab2/compose-2.png" width="250px"> </p>

<p>Now check for running nodes</p>

<div><pre><code class="language-bash">$ docker ps -a</code></pre></div>

<p>Output should be similar to:</p>

<!--![compose-3](/MizzouCloudDevOps/img/lab2/compose-3.png)-->

<p align="center"> <img src="/MizzouCloudDevOps/img/lab2/compose-3.png" width="1000px"> </p>

<h2 id="toc_9">3.3 Open vSwitch configuration on the other nodes</h2>

<p>Once your docker-compose topology is up and running, you will configure all the nodes except the Controller to activate the Open vSwitches (it is required on all the nodes, not just the two switches). First let’s look at the OVS configuration scripts on all the nodes (we use the Root Switch script as an example).</p>

<p>Root Switch:</p>

<div><pre><code class="language-bash">$ cat ~/Dolus-SDN-demo/root-switch/local/rootSwitch_config.sh</code></pre></div>

<p>Output:</p>

<div><pre><code class="language-bash">#!/bin/bash

# $1 is the public IP of your computer (local IP if you are using a router based home network)

#Color declarations
RED=&#39;\033[0;31m&#39;
GREEN=&#39;\033[0;32m&#39;
BLUE=&#39;\033[0;34m&#39;
LIGHTBLUE=&#39;\033[1;34m&#39;
LIGHTGREEN=&#39;\033[1;32m&#39;
NC=&#39;\033[0m&#39; # No Color

function checkErr() {
echo -e &quot;${RED}$1 failed. Exiting.${NC}&quot; &gt;&amp;2; exit;
}

#check to make sure argument IPs are provided
if [ &quot;$#&quot; -lt 1 ]
then
echo -e &quot;\n${RED}Not enough arguments supplied, please provide the IP of the Controller. Exiting...${NC}&quot;
exit
fi

# run ovs db
ovsdb-server -v --log-file --pidfile --remote=punix:/usr/local/var/run/openvswitch/db.sock &gt;/var/log/ovsdb.log
2&gt;&amp;1 &amp;
sleep 2

# run ovs switch
ovs-vswitchd --pidfile &gt;/var/log/vswitchd.log 2&gt;&amp;1 &amp;
echo -e &quot;\n${GREEN}Open vswitch service started... ${NC}\n&quot;
sleep 2


# set up bridges
echo -e &quot;\n${BLUE}Setting up briges... ${NC}\n&quot;
ovs-vsctl add-br br0 || checkErr &quot;setting up bridge error...&quot;

# setup VXLAN connections
echo -e &quot;\n#{BLUE}Setting up VXLAN connections ... \n&quot;
ovs-vsctl add-port br0 eth1 -- set interface eth1 type=vxlan options:remote_ip=172.18.0.4 options:key=
ovs-vsctl add-port br0 eth2 -- set interface eth2 type=vxlan options:remote_ip=172.18.0.5 options:key=

ifconfig br0 100.0.0.100 mtu 1400 up</code></pre></div>

<p>In this configuration script, you first start the OVS database and the OVS daemon process. Then you create a network bridge, add two interfaces each connecting to the two nodes attached to the Root Switch (reference the topology diagram to see which nodes are connected to the Root Switch and Slave Switch). Finally, you bring up the bridge network and activate it with the specified virtual IP.</p>

<p>Similarly, check the configuration scripts for all the other nodes in their respective directories in the GitHub repo.
You will see similar scripts, but with different number of interfaces depending on how many nodes they are connected to (you will only need to set controller to the Root and Slave Switches, not other nodes).</p>

<h2 id="toc_10">3.4 Configure the nodes</h2>

<p>For each of the nodes in the topology, we have prepared a Shell script file to configure the node to start up the OVS and create VXLAN to connect the nodes to either the Controller (from the Switches), or other nodes in the topology. For your convenience, we have prepared a Shell script to automate the configuration of all the nodes.</p>

<h3 id="toc_11">3.4.1 Configuration script</h3>

<div><pre><code class="language-bash">$ cat ~/Dolus-SDN-demo/ovs_configure.sh</code></pre></div>

<p>Output:</p>

<div><pre><code class="language-bash">#!/bin/bash

#Color declarations
RED=&#39;\033[0;31m&#39;
GREEN=&#39;\033[0;32m&#39;
BLUE=&#39;\033[0;34m&#39;
LIGHTBLUE=&#39;\033[1;34m&#39;
LIGHTGREEN=&#39;\033[1;32m&#39;
NC=&#39;\033[0m&#39; # No Color

function checkErr() {
echo -e &quot;${RED}$1 failed. Exiting.${NC}&quot; &gt;&amp;2; exit;
}

echo &quot;\n${BLUE}Acquiring Controller public IP address... ${NC}&quot;
export Controller_Public_IP=$(dig +short myip.opendns.com @resolver1.opendns.com) || checkErr &quot;Acquiring
Controller public IP&quot;

echo &quot;\n${BLUE}Controller public IP address is: ${NC}&quot;
echo $Controller_Public_IP

echo &quot;\n${BLUE}Setting up root switch node ${NC}&quot;
docker exec rootswitch bash -c &quot;bash /local/rootSwitch_config.sh ${Controller_Public_IP}&quot; || checkErr
&quot;Configuring Root Switch&quot;


echo &quot;\n${BLUE}Setting up slave switch node ${NC}&quot;
docker exec slaveswitch bash -c &quot;bash /local/slaveSwitch_config.sh ${Controller_Public_IP}&quot; || checkErr
&quot;Configuring Slave Switch&quot;

echo &quot;\n${BLUE}Setting up server node ${NC}&quot;
docker exec server bash -c &quot;bash /local/server_config.sh&quot; || checkErr &quot;Configuring Server&quot;

echo &quot;\n${BLUE}Setting up attacker node ${NC}&quot;
docker exec attacker bash -c &quot;bash /local/attacker_config.sh&quot; || checkErr &quot;Configuring Attacker&quot;

echo &quot;\n${BLUE}Setting up user node ${NC}&quot;
docker exec user bash -c &quot;bash /local/user_config.sh&quot; || checkErr &quot;Configuring User&quot;

echo &quot;\n${BLUE}Setting up qvm node ${NC}&quot;
docker exec qvm bash -c &quot;bash /local/qvm_config.sh&quot; || checkErr &quot;Configuring QVM&quot;

echo &quot;\n${GREEN}Finished configuring OVS on all the nodes... ${NC}&quot;</code></pre></div>

<h3 id="toc_12">3.4.2 Run the configuration</h3>

<p>Configure the VXLAN by running the following command:</p>

<div><pre><code class="language-bash">$ bash ~/Dolus-SDN-demo/ovs_configure.sh</code></pre></div>

<p>You will a long output on your screen displaying the configuration progress.</p>

<!--![ovs-6](/MizzouCloudDevOps/img/lab2/ovs-6.png)-->

<p align="center"> <img src="/MizzouCloudDevOps/img/lab2/ovs-6.png" width="500px"> </p>

<p>At the end, you will see “Finished configuring OVS on all the nodes...” if everything goes well on your instance.</p>

<!--![ovs-7](/MizzouCloudDevOps/img/lab2/ovs-7.png)-->

<p align="center"> <img src="/MizzouCloudDevOps/img/lab2/ovs-7.png" width="400px"> </p>

<h3 id="toc_13">3.4.3 Checking OVS setup in the nodes.</h3>

<p>Run the following command to check OVS bridge and interface setup in your topology.</p>

<div><pre><code class="language-bash">$ docker exec Node_Name ovs-vsctl show</code></pre></div>

<p>For example:</p>

<div><pre><code class="language-bash">$ docker exec rootswitch ovs-vsctl show</code></pre></div>

<p>Output:</p>

<!--![ovs-2](/MizzouCloudDevOps/img/lab2/ovs-2.png)-->

<p align="center"> <img src="/MizzouCloudDevOps/img/lab2/ovs-2.png" width="700px"> </p>

<h3 id="toc_14">3.4.4 Checking for network connections in your topology</h3>

<p>Before we use Frenetic to control your network, you should be able to make network connections among your nodes in the topology. Let’s try some ping commands and see if your VXLAN is actually up and running!</p>

<div><pre><code class="language-bash">$ docker exec attacker ping 100.0.0.102</code></pre></div>

<p>You should see responses messages from the Server back to the Attacker:</p>

<!--![ovs-4](/MizzouCloudDevOps/img/lab2/ovs-4.png)-->

<p align="center"> <img src="/MizzouCloudDevOps/img/lab2/ovs-4.png" width="700px"> </p>

<p>You can try out some other connections to see if all the nodes are able to connect to each other (not the Controller thougH). For example from Server to other nodes as below:</p>

<!--![ovs-5](/MizzouCloudDevOps/img/lab2/ovs-5.png)-->

<p align="center"> <img src="/MizzouCloudDevOps/img/lab2/ovs-5.png" width="700px"> </p>

<p><strong>Congratulations!</strong> You have a working VXLAN network in your topology, and now you are ready to use it for SDN!</p>

<!--<a href="#" class="previous">&laquo; Previous</a>
<p align = "right"><a href="#" class="next">Next &raquo;</a></p>-->



<script type="text/javascript">
var _self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{},Prism=function(){var e=/\blang(?:uage)?-(\w+)\b/i,t=0,n=_self.Prism={util:{encode:function(e){return e instanceof a?new a(e.type,n.util.encode(e.content),e.alias):"Array"===n.util.type(e)?e.map(n.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++t}),e.__id},clone:function(e){var t=n.util.type(e);switch(t){case"Object":var a={};for(var r in e)e.hasOwnProperty(r)&&(a[r]=n.util.clone(e[r]));return a;case"Array":return e.map&&e.map(function(e){return n.util.clone(e)})}return e}},languages:{extend:function(e,t){var a=n.util.clone(n.languages[e]);for(var r in t)a[r]=t[r];return a},insertBefore:function(e,t,a,r){r=r||n.languages;var l=r[e];if(2==arguments.length){a=arguments[1];for(var i in a)a.hasOwnProperty(i)&&(l[i]=a[i]);return l}var o={};for(var s in l)if(l.hasOwnProperty(s)){if(s==t)for(var i in a)a.hasOwnProperty(i)&&(o[i]=a[i]);o[s]=l[s]}return n.languages.DFS(n.languages,function(t,n){n===r[e]&&t!=e&&(this[t]=o)}),r[e]=o},DFS:function(e,t,a,r){r=r||{};for(var l in e)e.hasOwnProperty(l)&&(t.call(e,l,e[l],a||l),"Object"!==n.util.type(e[l])||r[n.util.objId(e[l])]?"Array"!==n.util.type(e[l])||r[n.util.objId(e[l])]||(r[n.util.objId(e[l])]=!0,n.languages.DFS(e[l],t,l,r)):(r[n.util.objId(e[l])]=!0,n.languages.DFS(e[l],t,null,r)))}},plugins:{},highlightAll:function(e,t){var a={callback:t,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};n.hooks.run("before-highlightall",a);for(var r,l=a.elements||document.querySelectorAll(a.selector),i=0;r=l[i++];)n.highlightElement(r,e===!0,a.callback)},highlightElement:function(t,a,r){for(var l,i,o=t;o&&!e.test(o.className);)o=o.parentNode;o&&(l=(o.className.match(e)||[,""])[1],i=n.languages[l]),t.className=t.className.replace(e,"").replace(/\s+/g," ")+" language-"+l,o=t.parentNode,/pre/i.test(o.nodeName)&&(o.className=o.className.replace(e,"").replace(/\s+/g," ")+" language-"+l);var s=t.textContent,u={element:t,language:l,grammar:i,code:s};if(!s||!i)return n.hooks.run("complete",u),void 0;if(n.hooks.run("before-highlight",u),a&&_self.Worker){var c=new Worker(n.filename);c.onmessage=function(e){u.highlightedCode=e.data,n.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(u.element),n.hooks.run("after-highlight",u),n.hooks.run("complete",u)},c.postMessage(JSON.stringify({language:u.language,code:u.code,immediateClose:!0}))}else u.highlightedCode=n.highlight(u.code,u.grammar,u.language),n.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(t),n.hooks.run("after-highlight",u),n.hooks.run("complete",u)},highlight:function(e,t,r){var l=n.tokenize(e,t);return a.stringify(n.util.encode(l),r)},tokenize:function(e,t){var a=n.Token,r=[e],l=t.rest;if(l){for(var i in l)t[i]=l[i];delete t.rest}e:for(var i in t)if(t.hasOwnProperty(i)&&t[i]){var o=t[i];o="Array"===n.util.type(o)?o:[o];for(var s=0;s<o.length;++s){var u=o[s],c=u.inside,g=!!u.lookbehind,h=!!u.greedy,f=0,d=u.alias;u=u.pattern||u;for(var p=0;p<r.length;p++){var m=r[p];if(r.length>e.length)break e;if(!(m instanceof a)){u.lastIndex=0;var y=u.exec(m),v=1;if(!y&&h&&p!=r.length-1){var b=r[p+1].matchedStr||r[p+1],k=m+b;if(p<r.length-2&&(k+=r[p+2].matchedStr||r[p+2]),u.lastIndex=0,y=u.exec(k),!y)continue;var w=y.index+(g?y[1].length:0);if(w>=m.length)continue;var _=y.index+y[0].length,P=m.length+b.length;if(v=3,P>=_){if(r[p+1].greedy)continue;v=2,k=k.slice(0,P)}m=k}if(y){g&&(f=y[1].length);var w=y.index+f,y=y[0].slice(f),_=w+y.length,S=m.slice(0,w),O=m.slice(_),j=[p,v];S&&j.push(S);var A=new a(i,c?n.tokenize(y,c):y,d,y,h);j.push(A),O&&j.push(O),Array.prototype.splice.apply(r,j)}}}}}return r},hooks:{all:{},add:function(e,t){var a=n.hooks.all;a[e]=a[e]||[],a[e].push(t)},run:function(e,t){var a=n.hooks.all[e];if(a&&a.length)for(var r,l=0;r=a[l++];)r(t)}}},a=n.Token=function(e,t,n,a,r){this.type=e,this.content=t,this.alias=n,this.matchedStr=a||null,this.greedy=!!r};if(a.stringify=function(e,t,r){if("string"==typeof e)return e;if("Array"===n.util.type(e))return e.map(function(n){return a.stringify(n,t,e)}).join("");var l={type:e.type,content:a.stringify(e.content,t,r),tag:"span",classes:["token",e.type],attributes:{},language:t,parent:r};if("comment"==l.type&&(l.attributes.spellcheck="true"),e.alias){var i="Array"===n.util.type(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(l.classes,i)}n.hooks.run("wrap",l);var o="";for(var s in l.attributes)o+=(o?" ":"")+s+'="'+(l.attributes[s]||"")+'"';return"<"+l.tag+' class="'+l.classes.join(" ")+'" '+o+">"+l.content+"</"+l.tag+">"},!_self.document)return _self.addEventListener?(_self.addEventListener("message",function(e){var t=JSON.parse(e.data),a=t.language,r=t.code,l=t.immediateClose;_self.postMessage(n.highlight(r,n.languages[a],a)),l&&_self.close()},!1),_self.Prism):_self.Prism;var r=document.currentScript||[].slice.call(document.getElementsByTagName("script")).pop();return r&&(n.filename=r.src,document.addEventListener&&!r.hasAttribute("data-manual")&&document.addEventListener("DOMContentLoaded",n.highlightAll)),_self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism),"undefined"!=typeof global&&(global.Prism=Prism);
</script>

<script type="text/javascript">
!function(e){var t={variable:[{pattern:/\$?\(\([\w\W]+?\)\)/,inside:{variable:[{pattern:/(^\$\(\([\w\W]+)\)\)/,lookbehind:!0},/^\$\(\(/],number:/\b-?(?:0x[\dA-Fa-f]+|\d*\.?\d+(?:[Ee]-?\d+)?)\b/,operator:/--?|-=|\+\+?|\+=|!=?|~|\*\*?|\*=|\/=?|%=?|<<=?|>>=?|<=?|>=?|==?|&&?|&=|\^=?|\|\|?|\|=|\?|:/,punctuation:/\(\(?|\)\)?|,|;/}},{pattern:/\$\([^)]+\)|`[^`]+`/,inside:{variable:/^\$\(|^`|\)$|`$/}},/\$(?:[a-z0-9_#\?\*!@]+|\{[^}]+\})/i]};e.languages.bash={shebang:{pattern:/^#!\s*\/bin\/bash|^#!\s*\/bin\/sh/,alias:"important"},comment:{pattern:/(^|[^"{\\])#.*/,lookbehind:!0},string:[{pattern:/((?:^|[^<])<<\s*)(?:"|')?(\w+?)(?:"|')?\s*\r?\n(?:[\s\S])*?\r?\n\2/g,lookbehind:!0,inside:t},{pattern:/(["'])(?:\\\\|\\?[^\\])*?\1/g,inside:t}],variable:t.variable,"function":{pattern:/(^|\s|;|\||&)(?:alias|apropos|apt-get|aptitude|aspell|awk|basename|bash|bc|bg|builtin|bzip2|cal|cat|cd|cfdisk|chgrp|chmod|chown|chroot|chkconfig|cksum|clear|cmp|comm|command|cp|cron|crontab|csplit|cut|date|dc|dd|ddrescue|df|diff|diff3|dig|dir|dircolors|dirname|dirs|dmesg|du|egrep|eject|enable|env|ethtool|eval|exec|expand|expect|export|expr|fdformat|fdisk|fg|fgrep|file|find|fmt|fold|format|free|fsck|ftp|fuser|gawk|getopts|git|grep|groupadd|groupdel|groupmod|groups|gzip|hash|head|help|hg|history|hostname|htop|iconv|id|ifconfig|ifdown|ifup|import|install|jobs|join|kill|killall|less|link|ln|locate|logname|logout|look|lpc|lpr|lprint|lprintd|lprintq|lprm|ls|lsof|make|man|mkdir|mkfifo|mkisofs|mknod|more|most|mount|mtools|mtr|mv|mmv|nano|netstat|nice|nl|nohup|notify-send|nslookup|open|op|passwd|paste|pathchk|ping|pkill|popd|pr|printcap|printenv|printf|ps|pushd|pv|pwd|quota|quotacheck|quotactl|ram|rar|rcp|read|readarray|readonly|reboot|rename|renice|remsync|rev|rm|rmdir|rsync|screen|scp|sdiff|sed|seq|service|sftp|shift|shopt|shutdown|sleep|slocate|sort|source|split|ssh|stat|strace|su|sudo|sum|suspend|sync|tail|tar|tee|test|time|timeout|times|touch|top|traceroute|trap|tr|tsort|tty|type|ulimit|umask|umount|unalias|uname|unexpand|uniq|units|unrar|unshar|uptime|useradd|userdel|usermod|users|uuencode|uudecode|v|vdir|vi|vmstat|wait|watch|wc|wget|whereis|which|who|whoami|write|xargs|xdg-open|yes|zip)(?=$|\s|;|\||&)/,lookbehind:!0},keyword:{pattern:/(^|\s|;|\||&)(?:let|:|\.|if|then|else|elif|fi|for|break|continue|while|in|case|function|select|do|done|until|echo|exit|return|set|declare)(?=$|\s|;|\||&)/,lookbehind:!0},"boolean":{pattern:/(^|\s|;|\||&)(?:true|false)(?=$|\s|;|\||&)/,lookbehind:!0},operator:/&&?|\|\|?|==?|!=?|<<<?|>>|<=?|>=?|=~/,punctuation:/\$?\(\(?|\)\)?|\.\.|[{}[\];]/};var a=t.variable[1].inside;a["function"]=e.languages.bash["function"],a.keyword=e.languages.bash.keyword,a.boolean=e.languages.bash.boolean,a.operator=e.languages.bash.operator,a.punctuation=e.languages.bash.punctuation}(Prism);
</script>

<script type="text/javascript">
Prism.languages.yaml={scalar:{pattern:/([\-:]\s*(![^\s]+)?[ \t]*[|>])[ \t]*(?:((?:\r?\n|\r)[ \t]+)[^\r\n]+(?:\3[^\r\n]+)*)/,lookbehind:!0,alias:"string"},comment:/#.*/,key:{pattern:/(\s*[:\-,[{\r\n?][ \t]*(![^\s]+)?[ \t]*)[^\r\n{[\]},#]+?(?=\s*:\s)/,lookbehind:!0,alias:"atrule"},directive:{pattern:/(^[ \t]*)%.+/m,lookbehind:!0,alias:"important"},datetime:{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)(\d{4}-\d\d?-\d\d?([tT]|[ \t]+)\d\d?:\d{2}:\d{2}(\.\d*)?[ \t]*(Z|[-+]\d\d?(:\d{2})?)?|\d{4}-\d{2}-\d{2}|\d\d?:\d{2}(:\d{2}(\.\d*)?)?)(?=[ \t]*($|,|]|}))/m,lookbehind:!0,alias:"number"},"boolean":{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)(true|false)[ \t]*(?=$|,|]|})/im,lookbehind:!0,alias:"important"},"null":{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)(null|~)[ \t]*(?=$|,|]|})/im,lookbehind:!0,alias:"important"},string:{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)("(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*')(?=[ \t]*($|,|]|}))/m,lookbehind:!0},number:{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)[+\-]?(0x[\da-f]+|0o[0-7]+|(\d+\.?\d*|\.?\d+)(e[\+\-]?\d+)?|\.inf|\.nan)[ \t]*(?=$|,|]|})/im,lookbehind:!0},tag:/![^\s]+/,important:/[&*][\w]+/,punctuation:/---|[:[\]{}\-,|>?]|\.\.\./};
</script>

<script type="text/javascript">
Prism.languages.docker={keyword:{pattern:/(^\s*)(?:ONBUILD|FROM|MAINTAINER|RUN|EXPOSE|ENV|ADD|COPY|VOLUME|USER|WORKDIR|CMD|LABEL|ENTRYPOINT)(?=\s)/im,lookbehind:!0},string:/("|')(?:(?!\1)[^\\\r\n]|\\(?:\r\n|[\s\S]))*?\1/,comment:/#.*/,punctuation:/---|\.\.\.|[:[\]{}\-,|>?]/};
</script>


</body>

</html>
